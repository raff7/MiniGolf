(function(){define("modules/clean/file_operations/notifications",["external/underscore","modules/core/html","modules/core/i18n","modules/core/notify","modules/clean/react/browse/api","modules/clean/browse_interface","modules/clean/em_string","modules/clean/react/browse/dispatcher","modules/clean/filepath","modules/clean/undo"],function(e,t,r,s,n,o,i,a,l,u){var c,p,d,h,f,m,_,g,y,S,b;return c=r._,b=r.ungettext,S=function(e,t,r,o){var i;return i=function(){return n.rollbackChangeSets({changesets:r,userId:t.id,progressText:c("Undoing…"),onSuccess:function(){return s.success(c("Undo complete.")),"function"==typeof o?o():void 0}})},u.notifyWithUndo(e,r,i)},p=function(t,r){var s,n,a;return n=o.browse_uri_for_fq_path(r,t),a=40,s=i.em_snippet(l.filename(t),a),{href:n,text:e.escape(s)}},d=function(e,r,s,n,o){var i,a,l;return null==n&&(n=null),n?(i=p(n,r),l=b('Copied %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Copied %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e),a=l.format({num_items:e,dest_href:i.href,dest_name:i.text}),a=new t(a)):(a=b("Copied %(num_items)d item.","Copied %(num_items)d items.",e),a=a.format({num_items:e})),S(a,r,s,o)},m=function(e,r,s,n,o){var i,a,l;return a=null,n?(i=p(n,r),l=b('Moved %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Moved %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e),a=l.format({num_items:e,dest_href:i.href,dest_name:i.text}),a=new t(a)):(l=b("Moved %(num_items)d item.","Moved %(num_items)d items.",e),a=l.format({num_items:e})),S(a,r,s,o)},h=function(e,r,s,n){var o,i;return i=b("Deleted %(num_items)d item","Deleted %(num_items)d items",e),o=i.format({num_items:e}),o=new t(o),S(o,r,s,n)},g=function(e,r,s){var n;return n=c("Rename complete."),n=new t(n),S(n,e,r,s)},f=function(e,r,s){var n,o;return o=c("Created folder %(folder_name)s"),n=o.format({folder_name:e}),n=new t(n),S(n,r,s)},_=function(e){var t,r;return r=b("Permanently deleted %(num)s item","Permanently deleted %(num)s items",e),t=r.format({num:e}),s.success(t)},y=function(r){var n,o,i,a;return n=r.length,1===n?(o=l.filename(r[0].fq_path),o=e.escape(o),a=c("Restored <strong>%(filename)s</strong>."),i=a.format({filename:o}),i=new t(i)):(a=b("Restored %(num)s file.","Restored %(num)s files.",n),i=a.format({num:n})),s.success(i)},{notifyCopySuccess:d,notifyMoveSuccess:m,notifyDeleteSuccess:h,notifyRestoreSuccess:y,notifyPurgeSuccess:_,notifyFolderCreationSuccess:f,notifyRenameSuccess:g}})}).call(this),function(){var e=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/browse/api",["external/underscore","modules/clean/ajax","modules/clean/react/browse/constants","modules/clean/filepath","modules/clean/history","modules/clean/pagination_manager","modules/clean/react/browse/store","modules/core/i18n","modules/core/notify","modules/core/uri","modules/constants/browse","modules/constants/viewer"],function(t,r,s,n,o,i,a,l,u,c,p,d){var h,f,m,_,g,y,S,b,v,w,F,T,D,P,R,C,E,I,M,N;return g=s.LoadingStates,_=a.File,h=a.BrowseContext,m=a.Config,f=a.BrowseStore,y=l._,N=function(e){var t,r;try{return JSON.parse(e)}catch(e){if(r=e,!(r instanceof SyntaxError))throw r}return null},w=function(t){var r,s;return r=null!=(s=t.containing_fq_path)?s:"",0!==r.indexOf("/")&&(r="/"+r),new h({currentNSID:t.containing_ns_id,currentFQPath:r,currentMountPoint:t.containing_mount_point,currentNSPath:t.containing_ns_path,currentSharedFolderPermissionRole:t.containing_sf_perm_role,currentNSAllowsNesting:e.call(t.containing_ns_permissions,"mount_shared_folders")>=0,inactiveNSIDByFQPath:t.old_path_to_ns_id,permanentDeletionDisabledStateByNSID:t.permanent_delete_is_disabled_by_ns_id,isInFolderMode:t.inside_dir,isInsideSharedFolder:t.inside_shared_folder,isInsideTeamFolder:t.inside_team_folder,isInsideDeletedFolder:t.inside_deleted_dir,isInsideDeletedSharedFolder:Boolean(t.inside_deleted_shared_folder),isInsideDeletedNestedSharedFolder:t.inside_deleted_nested_shared_folder,blockHash:t.block_hash,config:new m({isSimpleSharingEnabled:t.simple_sharing_enabled,isPublicFolderEnabled:t.public_folder_enabled,publicAppToken:t.public_app_token})})},P=function(e){var s,n,o,a,l,u,p,d;return u=e.path,d=e.userId,n=e.includeDeletedFiles,p=e.pathLoadCallback,s=e.filesAppendCallback,o=e.loadingStateCallback,a=e.mountPointCallback,l=e.onError,r.WebRequest({data:{show_deleted:n||""},url:c({path:"/browse"+u}),subject_user:d,success:function(e){var r,n,l;try{return t.isString(e)&&(e=JSON.parse(e)),r=w(e),a({mountPoints:e.ns_id_to_mount_point}),e.paginated?(o({loadingState:g.LOADING_REMAINING_PAGES}),l=new i,p({path:u,files:[],context:r}),l.initialize(e.first_page,"sjid","/browse_get_next",d,function(e,t){return s({path:u,files:t}),e.areAllItemsReady()?(o({loadingState:g.LOADED}),e.stopAutoFetching()):void 0}),l.startAutoFetching()):(n=e.file_info,p({path:u,files:n,context:r}),void o({loadingState:g.LOADED}))}catch(e){}},error:function(e,t,r){return"function"==typeof l?l(e,t,r):void 0}})},S=function(s){var n,o,i,a,l,p;return o=s.files,a=s.newPath,p=s.userId,l=s.onSuccess,i=function(){var e,t,r;for(r=[],e=0,t=o.length;t>e;e++)n=o[e],r.push(n.fq_path);return r}(),e.call(i,a)>=0?void u.error(y("You can’t copy a folder into itself.")):r.WebProgressRequest({url:c({path:"/cmd/copy"}),data:{files:i,to_path:a},subject_user:p,progress_text:y("Copying files..."),success:function(e){try{return t.isString(e)&&(e=JSON.parse(e)),o=function(){var t,r,s,o;for(s=e.new_browse_files,o=[],t=0,r=s.length;r>t;t++)n=s[t],o.push(new _(n));return o}(),l({files:o,destinationPath:a,changesets:e.changesets})}catch(e){}}})},v=function(e){var s,n,o,i,a;return n=e.files,a=e.userId,i=e.onSuccess,o=function(){var e,t,r;for(r=[],e=0,t=n.length;t>e;e++)s=n[e],r.push(s.fq_path);return r}(),r.WebProgressRequest({url:c({path:"/cmd/delete"}),data:{files:o},subject_user:a,progress_text:y("Deleting files..."),success:function(e){var r,s;try{return t.isString(e)&&(e=JSON.parse(e)),s=function(){var e,t,s;for(s=[],e=0,t=n.length;t>e;e++)r=n[e],s.push({before:r,after:null});return s}(),i({fileDeltas:s,changesets:e.changesets})}catch(e){}}})},R=function(s){var o,i,a,l,p,d,h;return d=s.path,i=s.files,l=s.newPath,h=s.userId,p=s.onSuccess,d!==l?(a=function(){var e,t,r;for(r=[],e=0,t=i.length;t>e;e++)o=i[e],r.push(o.fq_path);return r}(),e.call(a,l)>=0?void u.error(y("You can’t move a folder into itself.")):r.WebProgressRequest({url:c({path:"/cmd/move"}),data:{files:a,to_path:l},subject_user:h,progress_text:y("Moving files..."),success:function(e){var r;try{return t.isString(e)&&(e=JSON.parse(e)),i=f.filesMap(),r=function(){var r,s,l,u;for(l=e.new_browse_files,u=[],r=0,s=l.length;s>r;r++)o=l[r],u.push({before:i.get(t.find(a,function(e){return n.filename(e)===n.filename(o.fq_path)}),null),after:new _(o)});return u}(),p({path:d,destinationPath:l,fileDeltas:r,changesets:e.changesets})}catch(e){}}})):void 0},E=function(e){var t,s,n,o,i;return t=e.file,s=e.newName,i=e.userId,o=e.onSuccess,n=e.onError,r.WebRequest({url:c({path:"/cmd/rename"+t.fq_path}).toString(),subject_user:i,data:{to_path:s},success:function(e){var t,r,s,i;i=null;try{i=JSON.parse(e)}catch(e){if(t=e,!(t instanceof SyntaxError))throw t}return i?(s=new _(i.new_browse_files[0]),o({changesets:i.changesets,renamedFile:s})):n?n():void 0},error:n?n:void 0})},D=function(e){var t,r,s,n;return t=e.fqPath,n=e.userId,r={prev:c.parse(o.get_url()).setFragment("").toString()},r[d.UID_PARAM_NAME]=n,t=t.replace(/^[\/]/,""),s=c({path:"/restore/"+t}).updateQuery(r),s.toString()},T=function(e){var t,r,s,n;return t=e.fqPath,n=e.userId,s={undelete:1},s[d.UID_PARAM_NAME]=n,t=t.replace(/^[\/]/,""),r=p.REVISION_HISTORY_WEB?"/history":"/revisions",c({path:r+"/"+t}).updateQuery(s)},I=function(e){var s,n,o;return s=e.files,o=e.userId,n=e.onSuccess,r.WebProgressRequest({url:"/cmd/restore",data:{files:t.pluck(s,"fq_path")},subject_user:o,dataType:"json",progress_text:y("Restoring…"),success:function(){return n()}})},C=function(e){var s,n,o,i,a;return s=e.files,a=e.userId,n=e.onSuccess,o=null!=(i=e.progressText)?i:y("Deleting…"),r.WebProgressRequest({url:"/cmd/purge",data:{files:t.pluck(s,"fq_path")},subject_user:a,dataType:"text",progress_text:o,success:function(e){var t;return t=N(e),t&&"success"===t.status?n():void 0}})},M=function(e){var t,s,n,o;return o=e.userId,t=e.changesets,n=e.progressText,s=e.onSuccess,r.WebProgressRequest({url:c({path:"/cmd/rollback"}),data:{ns_to_cs:JSON.stringify(t)},subject_user:o,progress_text:n,success:function(){return s()}})},b=function(e){var t,s,n,o,i;return o=e.pathName,t=e.folderName,i=e.userId,n=e.onSuccess,s=e.onError,r.WebProgressRequest({url:c({path:"/cmd/new"+o}),data:{to_path:t,folder:"yes"},subject_user:i,success:function(e){var t,r;return t=N(e),t?(r=new _(t.new_browse_files[0]),n({changesets:t.changesets,createdFolder:r})):void 0},error:function(){return s()}})},F=function(e){var t,s,n,o,i,a,l,u,p;return a=e.path,p=e.userId,s=e.namespaceToJournalIdMap,t=e.includeDeletedFiles,o=e.onSuccess,l="/"===a?"":a,i={fq_dir:l,ns_map:function(){var e;e=[];for(n in s)u=s[n],e.push(n+"_"+u);return e}().join(","),show_deleted:Boolean(t)},r.WebRequest({url:c({path:"/update/list_dir"}),subject_user:p,data:i,dataType:"text",success:function(e){var t;return t=N(e),t?o(t):void 0}})},{loadPath:P,copyFiles:S,moveFiles:R,deleteFiles:v,renameFile:E,getFileHistoryUrl:T,getRestoreFileUrl:D,restoreFiles:I,purgeFiles:C,rollbackChangeSets:M,getChangesForDirectory:F,createNewFolder:b,extractBrowseContext:w}})}.call(this),function(){define("modules/clean/react/browse/dispatcher",["modules/clean/flux/dispatcher"],function(e){return e})}.call(this),function(){define("modules/clean/react/browse/internal_drag_status",["external/immutable","external/react","jquery","modules/clean/react/sprite"],function(e,t,r,s){var n,o,i;return i=t.DOM,o=t.createElement,n=t.createClass({displayName:"InternalDragStatus",mixins:[t.addons.PureRenderMixin],propTypes:{files:t.PropTypes.instanceOf(e.List).isRequired},_STATUS_OFFSET:10,_SCROLL_AMOUNT:40,_SCROLL_WINDOW:50,_SCROLL_PERIOD:100,getInitialState:function(){return{left:0,top:0}},componentDidMount:function(){var e,t,s,n;return this.$dragStatusContainer=r("<div>").css({"z-index":1000001}).appendTo(document.body),n=this.renderDragStatus(),t=r(n.getDOMNode()),t.addClass("selection"),t.show(),s=r(window),e=r(document),e.on("mousemove.internalDragStatus",function(t){return function(r){return t.mouseViewportX=r.pageX-e.scrollLeft(),t.mouseViewportY=r.pageY-e.scrollTop(),r.buttons%2===1?t.setState({left:t.mouseViewportX+t._STATUS_OFFSET,top:t.mouseViewportY+t._STATUS_OFFSET}):void 0}}(this)),this.interval=setInterval(function(t){return function(){var r;return r=t.mouseViewportY<t._SCROLL_WINDOW?-t._SCROLL_WINDOW:t.mouseViewportY>s.height()-t._SCROLL_WINDOW?t._SCROLL_WINDOW:0,0!==r?e.scrollTop(e.scrollTop()+r):void 0}}(this),this._SCROLL_PERIOD)},componentDidUpdate:function(){return this.renderDragStatus()},componentWillUnmount:function(){return r(document).off("mousemove.internalDragStatus"),this.interval&&clearInterval(this.interval),this.$dragStatusContainer.remove()},renderDragStatus:function(){var e;return e=i.div({id:"drag-status",className:"active",style:{left:this.state.left,top:this.state.top}},i.div({id:"drag-selection-status"},this.props.files.toArray().slice(0,4).map(function(e,t){return e.thumbnail_url_tmpl?i.img({src:e.thumbnail_url_tmpl,className:"icon icon"+t,alt:""}):o(s,{group:"web",name:e.icon,className:"icon icon"+t,alt:""})}),i.span({className:"badge"},this.props.files.count()))),t.render(e,this.$dragStatusContainer[0])},render:function(){return i.div({})}}),{InternalDragStatus:n}})}.call(this),function(){define("modules/clean/react/browse/keyboard_shortcuts",["external/react","modules/core/browser","modules/core/i18n"],function(e,t,r){var s,n,o,i;return o=r._,i=e.DOM,n=[{key:"↑",desc:o("Select previous file (hold shift to select range)",{comment:"Shift refers to the shift key"})},{key:"↓",desc:o("Select next file (hold shift to select range)",{comment:"Shift refers to the shift key"})},{windowsKey:"ctrl + a",macKey:"⌘ + a",desc:o("Select all files")},{key:"esc",desc:o("Deselect all files (and hide these instructions)")},{key:"←",desc:o("Go up a folder")},{key:"/",desc:o("Search")},{key:"→",desc:o("Open folder")},{key:"enter",desc:o("Open file or folder")},{key:"alt + a",desc:o("Show action menu for selected file(s)")},{windowsKey:"ctrl + c",macKey:"⌘ + c",desc:o("Copy selected file(s)")},{windowsKey:"ctrl + v",macKey:"⌘ + v",desc:o("Paste selected file(s) into the current folder")},{key:"F2",desc:o("Rename selected file")},{windowsKey:"Delete",macKey:"delete",desc:o("Delete selected file(s)")},{windowsKey:"ctrl + z",macKey:"⌘ + z",desc:o("Undo recent move/copy/rename/delete")},{key:"?",desc:o("Show keyboard shortcuts")}],s=e.createClass({displayName:"KeyboardShortcuts",_renderShortcutsItem:function(e){return i.li({className:"keyboard-shortcuts__item"},i.span({className:"keyboard-shortcuts__key"},e.key?e.key:t.mac?e.macKey:e.windowsKey),i.span({className:"keyboard-shortcuts__desc"},e.desc))},render:function(){var e,t;return e=Math.round(n.length/2),i.div({className:"keyboard-shortcuts"},i.h2({className:"keyboard-shortcuts__header"},o("Dropbox keyboard shortcuts")),i.ul({className:"keyboard-shortcuts__pane"},function(){var r,s,o,i;for(o=n.slice(0,e),i=[],r=0,s=o.length;s>r;r++)t=o[r],i.push(this._renderShortcutsItem(t));return i}.call(this)),i.ul({className:"keyboard-shortcuts__pane"},function(){var r,s,o,i;for(o=n.slice(e),i=[],r=0,s=o.length;s>r;r++)t=o[r],i.push(this._renderShortcutsItem(t));return i}.call(this)))}})})}.call(this),function(){define("modules/clean/react/browse/name_input",["external/underscore","external/classnames","external/react","modules/clean/keycode","modules/clean/raf"],function(e,t,r,s,n){var o,i,a;return a=r.DOM,i=r.PropTypes,o=r.createClass({mixins:[r.addons.PureRenderMixin],displayName:"NameInput",propTypes:{defaultValue:i.string.isRequired,label:i.string.isRequired,onSubmit:i.func,onCancel:i.func,className:i.string},getDefaultProps:function(){return{onSubmit:e.noop,onCancel:e.noop,className:""}},componentDidMount:function(){var e;return e=this.refs.input.getDOMNode(),e.focus(),n.requestAnimationFrame(function(){var t,r;return t=e.value,r=t.lastIndexOf("."),-1===r&&(r=t.length),e.setSelectionRange(0,r)})},_checkValue:function(){var e;return e=this.refs.input.getDOMNode().value,e===this.props.defaultValue?this.props.onCancel():this.props.onSubmit(e)},_onSubmit:function(e){return e.preventDefault(),this._checkValue()},_onKeyDown:function(e){return e.keyCode===s.ESC?(e.preventDefault(),this.props.onCancel()):void 0},_onBlur:function(){return this._checkValue()},render:function(){var e;return e=a.input({ref:"input",defaultValue:this.props.defaultValue,className:t("c-input",this.props.className),onBlur:this._onBlur,onKeyDown:this._onKeyDown,"aria-label":this.props.label}),a.form({className:"u-pad-right-xs",onSubmit:this._onSubmit},e)}})})}.call(this),function(){define("modules/clean/react/browse/render_partials",["external/react","modules/clean/react/sprite","modules/clean/react/browse/models"],function(e,t,r){var s,n,o,i;return s=r.File,i=e.DOM,o=e.createElement,n=e.createClass({displayName:"FileIconView",propTypes:{file:e.PropTypes.instanceOf(s).isRequired,onClick:e.PropTypes.func,className:e.PropTypes.string},getDefaultProps:function(){return{onClick:function(){},onDragStart:function(){},className:""}},getInitialState:function(){return{hasThumbFailed:!1}},render:function(){return this.props.file.thumbnail_url_tmpl&&!this.state.hasThumbFailed?i.img({src:this.props.file.thumbnail_url_tmpl,className:"browse-file-row__accessory "+this.props.className,alt:"",onError:function(e){return function(){return e.setState({hasThumbFailed:!0})}}(this),onClick:this.props.onClick,onDragStart:this.props.onDragStart}):o(t,{group:"web",name:this.props.file.icon,className:"browse-file-row__accessory "+this.props.className,alt:"",onClick:this.props.onClick,onDragStart:this.props.onDragStart})}}),{FileIcon:n}})}.call(this),function(){define("modules/clean/react/browse/util",["modules/clean/em_string","modules/clean/filepath","modules/constants/browse","modules/constants/viewer","modules/core/i18n","modules/core/uri"],function(e,t,r,s,n,o){var i,a,l,u;return i=n._,u=n.ungettext,a=function(r){var s,n,o,a,l,c,p,d,h,f,m;return s=13.5,1===r.count()?(a=r.first(),l=t.filename(a.fq_path),o=e.em_snippet(l,s)):r.count()>1&&(n=function(e){return e.isDeleted()},h=r.some(n)&&!r.every(n),d=function(){var e,t,s,n;for(s=r.toArray(),n=[],e=0,t=s.length;t>e;e++)p=s[e],p.is_dir&&n.push(p);return n}(),c=function(){var e,t,s,n;for(s=r.toArray(),n=[],e=0,t=s.length;t>e;e++)a=s[e],a.is_dir||n.push(a);return n}(),h?o=i("No available actions"):(f=[],c.length&&(m=u("%(num_files)d file","%(num_files)d files",c.length).format({num_files:c.length}),f.push(m)),d.length&&(m=u("%(num_folders)d folder","%(num_folders)d folders",d.length).format({num_folders:d.length}),f.push(m)),o=2===f.length?i("%(x)s and %(y)s",{comment:'The whole string is a phrase like "2 files and 3 folders". `x` is a string containing a phrase like "2 files" and `y` is a string containing a phrase like "3 folders".'}).format({x:f[0],y:f[1]}):f[0])),o},l=function(e,t,n){return null==n&&(n={}),n[s.UID_PARAM_NAME]=String(t),r.REVISION_HISTORY_WEB?o({path:"/history"+e}).updateQuery(n):o({path:"/revisions"+e}).updateQuery(n)},{describeFiles:a,getRevisionsUri:l}})}.call(this),function(){define("modules/clean/react/context_menu_v2",["jquery","external/immutable","external/keymaster","external/react","external/underscore","modules/clean/keycode","modules/clean/react/css","modules/clean/react/sprite_div","modules/core/browser","modules/core/dom","modules/clean/react/browse/constants"],function(e,t,r,s,n,o,i,a,l,u,c){var p,d,h,f,m,_,g,y,S,b;return _=c.MouseEventButton,y=s.createElement,S=s.addons.classSet,b=s.DOM,g="",h=t.Record({icon:null,text:"",shouldShow:!0,isDisabled:!1,onClick:n.noop,href:null,subMenuItems:null}),m=s.createClass({displayName:"GlobalContextMenu",propTypes:{alwaysOpenOnCapture:s.PropTypes.bool,ignoreSelectors:s.PropTypes.string,items:s.PropTypes.arrayOf(h),onMenuOpen:s.PropTypes.func,onMenuClose:s.PropTypes.func},getDefaultProps:function(){return{alwaysOpenOnCapture:!1,ignoreSelectors:"a, input, button, textarea, select",onMenuOpen:n.noop,onMenuClose:n.noop}},getInitialState:function(){return{isMenuOpen:!1}},componentDidMount:function(){return e(document).on("contextmenu.GlobalContextMenu",function(t){return function(r){return 0===e(r.target).closest(t.props.ignoreSelectors).size()?t.toggleMenu(r):t.closeMenu()}}(this)),e(document).on("click.GlobalContextMenu",function(t){return function(r){return r.button!==_.RIGHT&&0===e(r.target).closest(".context-menu").size()?t.closeMenu():void 0}}(this))},componentWillUnmount:function(){return e(document).off(".GlobalContextMenu")},openMenuAtPosition:function(e,t,r){return this.setState({isMenuOpen:!0,left:e,top:t}),this.props.onMenuOpen(r)},closeMenu:function(){return this.setState({isMenuOpen:!1}),this.props.onMenuClose()},toggleMenu:function(e){return e.shiftKey?void 0:(e.preventDefault(),this.state.isMenuOpen&&!this.props.alwaysOpenOnCapture?this.closeMenu():this.openMenuAtPosition(e.clientX,e.clientY,e))},render:function(){return b.span({},this.state.isMenuOpen?y(f,{initialLeft:this.state.left,initialTop:this.state.top,onMenuClose:this.closeMenu,items:this.props.items,ref:"contextMenu"}):void 0)}}),d=s.createClass({displayName:"ContextMenuHandler",propTypes:{alwaysOpenOnCapture:s.PropTypes.bool,className:s.PropTypes.string,items:s.PropTypes.arrayOf(h),onMenuOpen:s.PropTypes.func,onMenuClose:s.PropTypes.func},getDefaultProps:function(){return{onMenuOpen:n.noop,onMenuClose:n.noop,alwaysOpenOnCapture:!1}},getInitialState:function(){return{isMenuOpen:!1}},componentDidMount:function(){return e(document).on("click.ContextMenuHandler",function(t){return function(r){return r.button!==_.RIGHT&&0===e(r.target).closest(".context-menu").size()?t.closeMenu():void 0}}(this))},componentWillUnmount:function(){return e(document).off(".ContextMenuHandler")},openMenuAtPosition:function(e,t,r){return this.setState({isMenuOpen:!0,left:e,top:t}),this.props.onMenuOpen(r)},closeMenu:function(){return this.setState({isMenuOpen:!1}),this.props.onMenuClose()},toggleMenu:function(e){return e.shiftKey?void 0:(e.preventDefault(),this.state.isMenuOpen&&!this.props.alwaysOpenOnCapture?this.closeMenu():this.openMenuAtPosition(e.clientX,e.clientY,e))},render:function(){return b.span({className:this.props.className},this.state.isMenuOpen?y(f,{initialLeft:this.state.left,initialTop:this.state.top,onMenuClose:this.closeMenu,items:this.props.items,ref:"contextMenu"}):void 0,b.span({"aria-haspopup":!0,onContextMenuCapture:this.toggleMenu,ref:"contextMenuTarget"},this.props.children))}}),p=s.createClass({displayName:"ContextMenu",propTypes:{initialLeft:s.PropTypes.number,initialTop:s.PropTypes.number,items:s.PropTypes.arrayOf(h),onMenuClose:s.PropTypes.func,onCurrentMenuClose:s.PropTypes.func,level:s.PropTypes.number,shouldAutoSelect:s.PropTypes.bool},getDefaultProps:function(){return{initialLeft:null,initialTop:null,items:null,onMenuClose:n.noop,onCurrentMenuClose:n.noop,level:0,shouldAutoSelect:!1}},getInitialState:function(){return{selectedIndex:null,left:null,right:null,isSubMenuOpen:!1}},componentWillMount:function(){return this.setState({left:this.props.initialLeft,top:this.props.initialTop})},componentDidMount:function(){return g=key.getScope(),key.setScope("ContextMenu"),this.updateCoordinates(),this.refs.contextMenu.getDOMNode().focus(),this.props.shouldAutoSelect?this._selectNextItem():void 0},componentDidUpdate:function(e){return e.items!==this.props.items||e.initialLeft!==this.props.initialLeft||e.initialTop!==this.props.initialTop?(this.setState({selectedIndex:null}),this.updateCoordinates(),this.refs.contextMenu.getDOMNode().focus()):void 0},componentWillUnmount:function(){return key.setScope(g)},_getReachableIndices:function(){var e,t,r,s,n,o;for(n=[],o=this.props.items,e=r=0,s=o.length;s>r;e=++r)t=o[e],t.shouldShow&&!t.isDisabled&&n.push(e);return n},_selectNextItem:function(){var e,t;return e=this._getReachableIndices(),t=null!=this.state.selectedIndex?(e.indexOf(this.state.selectedIndex)+1)%e.length:0,null!=t?this.selectItem(e[t]):void 0},_selectPreviousItem:function(){var e,t;return e=this._getReachableIndices(),t=null!=this.state.selectedIndex?(e.indexOf(this.state.selectedIndex)+e.length-1)%e.length:e.length-1,null!=t?this.selectItem(e[t]):void 0},_handleKeyDown:function(e){var t,r,s,n,i,a,l,u;if(!this.state.isSubMenuOpen)switch(e.keyCode){case o.TAB:return e.preventDefault(),e.stopPropagation();case o.ESC:return this.props.onMenuClose();case o.SPACE:case o.ENTER:if(null!=this.state.selectedIndex)return l=this.props.items[this.state.selectedIndex],this.clickItem(l,e),this.openSubMenu(l,!0),e.preventDefault(),e.stopPropagation();break;case o.DOWN:return this._selectNextItem(),e.preventDefault(),e.stopPropagation();case o.UP:return this._selectPreviousItem(),e.preventDefault(),e.stopPropagation();case o.RIGHT:if(null!=this.state.selectedIndex)return this.openSubMenu(this.props.items[this.state.selectedIndex],!0);break;case o.LEFT:if(this.props.level>0)return this.props.onCurrentMenuClose(),e.preventDefault(),e.stopPropagation();break;default:for(u=String.fromCharCode(e.keyCode),i=this.props.items,a=[],t=s=0,n=i.length;n>s;t=++s)if(r=i[t],r.shouldShow&&!r.isDisabled){if(r.text[0].toUpperCase()===u){this.selectItem(t),e.preventDefault(),e.stopPropagation();break}a.push(void 0)}return a}},openSubMenu:function(e,t){var r;return(null!=(r=e.subMenuItems)?r.length:void 0)>0?this.setState({isSubMenuOpen:!0,shouldAutoSelectSubMenu:t}):void 0},closeSubMenu:function(){return this.refs.contextMenu.getDOMNode().focus(),this.setState({isSubMenuOpen:!1})},selectItemWithMouse:function(e){return this.refs.contextMenu.getDOMNode().focus(),this.selectItem(e,!0,!1)},selectItem:function(e,t,r){return this.setState({selectedIndex:e}),t?this.openSubMenu(this.props.items[e],r):void 0},clickItem:function(e,t){return null!=e.subMenuItems||e.isDisabled?void 0:(null!=e.href?l.redirect(e.href):e.onClick(t),this.props.onMenuClose())},updateCoordinates:function(){var t,r,s,n,o,i,a,l;return t=this.props.initialLeft,a=this.props.initialTop,null!=t&&null!=a&&null!=this.refs.contextMenu&&(l=u.viewport_dimensions(),i=15,o=e(this.refs.contextMenu.getDOMNode()).width(),n=e(this.refs.contextMenu.getDOMNode()).height(),r=l.width-i-o,t>r&&(t=r),s=l.height-i-n,a>s&&(a=s)),this.setState({left:t,top:a})},getSelectedItemDomId:function(){return null!=this.state.selectedIndex?"contextMenu"+this.props.level+"-item"+this.state.selectedIndex:""},_renderItem:function(e,t){var r,s,n,o,i;return n=this.state.selectedIndex===t,s=(null!=(i=e.subMenuItems)?i.length:void 0)>0,o="contextMenu"+this.props.level+"-item"+t,r={"context-menu-item":!0,"context-menu-item--has-submenu":s,"context-menu-item--selected":n,"context-menu-item--disabled":e.isDisabled},b.li({key:o,id:o,"data-action":e.text,className:S(r),role:"menuitem","aria-haspopup":s,"aria-disabled":e.isDisabled,onMouseEnter:function(r){return function(){return e.isDisabled?r.setState({selectedIndex:null}):r.selectItemWithMouse(t)}}(this),onClick:function(t){return function(r){return t.clickItem(e,r)}}(this)},null!=e.icon?y(a,{group:e.icon.group,name:e.icon.name,alt:"",text:e.text}):b.span({},e.text),s?b.span({className:"context-menu-item__accessory c-arrow--right"}):void 0,s&&n&&this.state.isSubMenuOpen?y(p,{initialLeft:null,initialTop:null,className:"context-menu--secondary",level:this.props.level+1,items:e.subMenuItems,onMenuClose:this.props.onMenuClose,onCurrentMenuClose:this.closeSubMenu,shouldAutoSelect:this.state.shouldAutoSelectSubMenu}):void 0)},render:function(){var e,t,r;return null!=this.state.left&&null!=this.state.top&&(r={left:this.state.left,top:this.state.top}),b.ul({id:"contextMenu"+this.props.level,ref:"contextMenu",className:S("no-padding","bubble-dropdown","context-menu",this.props.className),style:r,role:"menu",tabIndex:-1,"aria-activedescendant":this.getSelectedItemDomId(),onKeyDown:this._handleKeyDown},function(){var r,s,n,o;for(n=this.props.items,o=[],e=r=0,s=n.length;s>r;e=++r)t=n[e],t.shouldShow&&o.push(this._renderItem(t,e));return o}.call(this))}}),f=i(p,["/static/css/context_menu-vfldTBOhw.css","/static/css/scooter/scooter-scoped-vfl_Zq9la.css"]),{GlobalContextMenu:m,ContextMenuHandler:d,ContextMenu:p,ContextMenuItem:h}})}.call(this),function(){define("modules/clean/react/file_modal_controller",["external/react","external/underscore","modules/clean/filepath","modules/clean/react/browse/api","modules/clean/react/css","modules/clean/react/file_modals","modules/clean/react/modal"],function(e,t,r,s,n,o,i){var a,l,u,c,p,d,h,f;return u=o.FileTransferModal,h=o.RestoreFilesModal,d=o.PermanentlyDeleteModal,a=o.DeleteFileModal,c=i.Modal,f=e.createElement,p={COPY:"copy",MOVE:"move"},l=function(){function e(){}return e.showCopy=function(e,t,r,s){var n;return n=f(u,{files:t,operation:p.COPY,user:e,onSuccess:r,onUndo:s}),c.showInstance(n)},e.showMove=function(e,t,r,s){var n;return n=f(u,{files:t,operation:p.MOVE,user:e,onSuccess:r,onUndo:s}),c.showInstance(n)},e.showRestore=function(e,t,r){var s;return s=f(h,{files:t,userId:e.id,onSuccess:r}),c.showInstance(s)},e.showPermanentlyDelete=function(e,t,r){var s;return s=f(d,{files:t,userId:e.id,onSuccess:r}),c.showInstance(s)},e.showDelete=function(e,t,s,n){var o,i,l;return i=r.filename(s.currentFQPath),l=s.isInsideSharedFolder,o=f(a,{files:t,user:e,parentSharedFolderName:l?i:null,onUndo:n}),c.showInstance(o)},e}(),{FileModalController:l}})}.call(this),function(){define("modules/clean/react/file_modals",["external/react","external/underscore","modules/clean/react/browse/api","modules/clean/react/browse/models","modules/clean/react/browse/render_partials","modules/clean/react/css","modules/clean/react/react_i18n","modules/clean/react/modal","modules/clean/react/tree_view","modules/clean/file_operations/notifications","modules/clean/filepath","modules/clean/user","modules/core/html","modules/core/i18n"],function(e,t,r,s,n,o,i,a,l,u,c,p,d,h){var f,m,_,g,y,S,b,v,w,F,T,D,P,R;return m=s.File,_=n.FileIcon,w=i.R_,S=a.Modal,y=l.FolderTreeView,T=h._,R=h.ungettext,P=e.DOM,D=e.createElement,b={COPY:"copy",MOVE:"move"},v=e.createClass({displayName:"PermanentlyDeleteModal",propTypes:{files:e.PropTypes.arrayOf(m).isRequired,userId:e.PropTypes.number.isRequired},getDefaultProps:function(){return{onSuccess:t.noop}},handlePurged:function(){return u.notifyPurgeSuccess(this.props.files.length),this.props.onSuccess.apply(null,arguments)},handleAccept:function(){return r.purgeFiles({files:this.props.files,userId:this.props.userId,onSuccess:this.handlePurged})},getTitle:function(e){return R("Permanently delete file?","Delete %(num)s items permanently?",e).format({num:e})},renderContent:function(e){var t,r;return t=e.length,1===t?(r=c.filename(e[0].fq_path),D(w,{filename:r},"Are you sure you want to delete <strong>%(filename)s</strong> from your Dropbox permanently?")):P.span(null,R("Are you sure you want to permanently delete %(num)s item from your Dropbox?","Are you sure you want to permanently delete %(num)s items from your Dropbox?",t).format({num:t}))},render:function(){var e,t;return e=this.props.files.length,t={ref:"modal",title:this.getTitle(e),acceptButtonText:T("Delete permanently"),dismissButtonText:T("Cancel"),onAccept:this.handleAccept},D(S,t,this.renderContent(this.props.files))}}),F=e.createClass({displayName:"RestoreFilesModal",propTypes:{files:e.PropTypes.arrayOf(m).isRequired,userId:e.PropTypes.number.isRequired,onSuccess:e.PropTypes.func},getDefaultProps:function(){return{onSuccess:t.noop}},handleRestoreSuccess:function(){return u.notifyRestoreSuccess(this.props.files),this.props.onSuccess.apply(null,arguments)},handleRestoreClick:function(e){return e.preventDefault(),r.restoreFiles({files:this.props.files,userId:this.props.userId,onSuccess:this.handleRestoreSuccess}),this.refs.modal.close()},handleCancelClick:function(e){return e.preventDefault(),this.refs.modal.close()},getTitle:function(e){return R("Restore file?","Restore %(num)s items…",e).format({num:e})},renderSingleFileContent:function(e,t){return[D(w,{filename:c.filename(e.fq_path)},T("The most recent version of <strong>%(filename)s</strong> will be restored.")),P.div({className:"file-modal__single-file-row"},D(_,{file:e,className:"file-modal__single-file-row-icon"}),P.a({href:t,className:"file-modal__single-file-row-link"},c.filename(e.fq_path)))]},renderMultiFileContent:function(e){return P.span({},R(T("Are you sure you want to restore %(num)s item?"),T("Are you sure you want to restore %(num)s items?"),e.length).format({num:e.length}))},renderButtons:function(e){return P.div({className:"file-modal__buttons"},e?P.div({className:"file-modal__buttons__alt",ref:"revisionButton"},P.a({href:e},T("View other versions"))):void 0,P.div({className:"file-modal__buttons__main"},P.button({className:"button-primary db-modal-button",onClick:this.handleRestoreClick,ref:"primaryButton"},T("Restore")),P.button({className:"button-tertiary db-modal-button",onClick:this.handleCancelClick,ref:"tertiaryButton"},T("Cancel"))))},render:function(){var e,t,s,n;return t=this.props.files.length,n=null,1===t&&(n=r.getFileHistoryUrl({fqPath:this.props.files[0].fq_path,userId:this.props.userId}).toString()),s={ref:"modal",title:this.getTitle(t),buttonComponent:this.renderButtons(n)},e=1===t?this.renderSingleFileContent(this.props.files[0],n):this.renderMultiFileContent(this.props.files),D(S,s,e)}}),F=o(F,["/static/css/react/file_modal-vfl5O9OmZ.css"]),g=e.createClass({displayName:"FileTransferModal",statics:{Operations:b},propTypes:{files:e.PropTypes.arrayOf(e.PropTypes.shape({fq_path:e.PropTypes.string,is_dir:e.PropTypes.bool
})).isRequired,operation:e.PropTypes.oneOf([b.COPY,b.MOVE]).isRequired,user:e.PropTypes.instanceOf(p).isRequired,onSuccess:e.PropTypes.func,onUndo:e.PropTypes.func},getDefaultProps:function(){return{onSuccess:t.noop}},getInitialState:function(){return{selectedPath:null}},handleOperationSuccess:function(e){var t,r,s;return t=e.changesets,r=this.props.files.length,s=this.props.user,this.props.operation===b.MOVE?u.notifyMoveSuccess(r,s,t,this.state.selectedPath,this.props.onUndo):this.props.operation===b.COPY&&u.notifyCopySuccess(r,s,t,this.state.selectedPath,this.props.onUndo),this.props.onSuccess.apply(null,arguments)},handleAccept:function(){return this.props.operation===b.MOVE?r.moveFiles({files:this.props.files,newPath:this.state.selectedPath,userId:this.props.user.id,onSuccess:this.handleOperationSuccess}):this.props.operation===b.COPY?r.copyFiles({files:this.props.files,newPath:this.state.selectedPath,userId:this.props.user.id,onSuccess:this.handleOperationSuccess}):void 0},handleFolderSelected:function(e){return this.setState({selectedPath:e})},_getTitle:function(){var e,t;return e=this.props.files.length,this.props.operation===b.MOVE?t=this.props.files[0].is_dir?R("Move folder to…","Move %(num)d items to…",e,{comment:'"items" is a (potential) mix of files and folders'}):R("Move file to…","Move %(num)d items to…",e,{comment:'"items" is a (potential) mix of files and folders'}):this.props.operation===b.COPY&&(t=this.props.files[0].is_dir?R("Copy folder to…","Copy %(num)d items to…",e,{comment:'"items" is a (potential) mix of files and folders'}):R("Copy file to…","Copy %(num)d items to…",e,{comment:'"items" is a (potential) mix of files and folders'})),t.format({num:e})},_getActionButtonText:function(){return this.props.operation===b.COPY?T("Copy"):this.props.operation===b.MOVE?T("Move"):void 0},render:function(){return D(S,{ref:"modal",title:this._getTitle(),acceptButtonText:this._getActionButtonText(),onAccept:this.handleAccept,acceptButtonDisabled:!this.state.selectedPath,dismissButtonText:T("Cancel")},D(y,{ref:"tree-view",rootPath:"/",user:this.props.user,shouldAutoFocus:!0,onFolderSelected:this.handleFolderSelected}))}}),f=e.createClass({displayName:"DeleteFileModal",propTypes:{files:e.PropTypes.arrayOf(e.PropTypes.shape({fq_path:e.PropTypes.string,is_dir:e.PropTypes.bool})).isRequired,user:e.PropTypes.instanceOf(p).isRequired,parentSharedFolderName:e.PropTypes.string,onUndo:e.PropTypes.func},getDefaultProps:function(){return{parentSharedFolderName:null}},handleNotify:function(e){var t;return t=e.changesets,u.notifyDeleteSuccess(this.props.files.length,this.props.user,t,this.props.onUndo)},handleAccept:function(){return r.deleteFiles({files:this.props.files,userId:this.props.user.id,onSuccess:this.handleNotify})},_getTitle:function(){var e;return e=this.props.files,e.length<1?"":1===e.length?T(e[0].is_dir?"Delete folder?":"Delete file?"):R("Delete %(item_count)s item?","Delete %(item_count)s items?",e.length).format({item_count:e.length})},_getContents:function(){var e,t,r,s;return e=this.props.files,null==(null!=e?e.length:void 0)||e.length<1?"":(r=c.filename(e[0].fq_path),t=null!=e[0].target_ns,null!=this.props.parentSharedFolderName?(s=this.props.parentSharedFolderName,1===e.length&&t?w({filename:r},"Are you sure you want to delete the shared folder <b>%(filename)s</b>?"):1===e.length?w({filename:r,shared_folder_name:s},"Are you sure you want to delete <b>%(filename)s</b> from the shared folder ‘%(shared_folder_name)s’?"):R("Are you sure you want to delete %(item_count)s item from the shared folder ‘%(shared_folder_name)s’?","Are you sure you want to delete %(item_count)s items from the shared folder ‘%(shared_folder_name)s’?",e.length).format({item_count:e.length,shared_folder_name:s})):1===e.length&&t?w({filename:r},"Are you sure you want to delete the shared folder <b>%(filename)s</b>? This shared folder will stay shared with other members and you can rejoin it later."):1===e.length?w({filename:r},"Are you sure you want to delete <b>%(filename)s</b> from your Dropbox?"):R("Are you sure you want to delete %(item_count)s item from your Dropbox?","Are you sure you want to delete %(item_count)s items from your Dropbox?",e.length).format({item_count:e.length}))},render:function(){return D(S,{ref:"modal",title:this._getTitle(),onAccept:this.handleAccept,acceptButtonText:T("Delete"),dismissButtonText:T("Cancel")},this._getContents())}}),{FileTransferModal:g,RestoreFilesModal:F,PermanentlyDeleteModal:v,DeleteFileModal:f}})}.call(this),function(){define("modules/clean/react/outside_event",["external/react","external/underscore","modules/clean/react/util"],function(e,t,r){var s,n,o,i,a,l;return l=r.mergeProps,i=e.createElement,a=e.DOM,o=function(r,s,n,o){var a,u,c;return a=null!=(c=r.displayName)?c:"UnnamedComponent",e.createClass({displayName:"Outside"+s+"Handled"+a,propTypes:(u={},u[""+n]=e.PropTypes.func,u[""+o]=e.PropTypes.func,u),componentDidMount:function(){return document.addEventListener(s,this._handleOutsideEvent,!1)},componentWillUnmount:function(){return document.removeEventListener(s,this._handleOutsideEvent,!1)},render:function(){var e,s;return s=l(t.omit(this.props,n,o,"children"),(e={},e[""+n]=this._handleInsideEvent,e)),i(r,s,this.props.children)},_handleOutsideEvent:function(e){var t;return"function"==typeof(t=this.props)[o]?t[o](e):void 0},_handleInsideEvent:function(e){var t,r;return e.stopPropagation(),"function"==typeof(t=e.nativeEvent).stopImmediatePropagation&&t.stopImmediatePropagation(),"function"==typeof(r=this.props)[n]?r[n](e):void 0}})},s=o("div","click","onClick","onOutsideClick"),n=o("div","mousedown","onMouseDown","onOutsideMouseDown"),{OutsideClickHandler:s,OutsideMouseDownHandler:n,addOutsideEventHandling:o}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/search/actions",["external/immutable","modules/clean/filepath","modules/clean/history","modules/clean/react/browse/constants","modules/clean/search/api","modules/clean/search/constants","modules/clean/search/dispatcher","modules/clean/search/store","modules/constants/viewer","modules/core/uri"],function(t,r,s,n,o,i,a,l,u){var c,p,d,h,f;return c=n.BrowseActionTypes,d=i.SearchActionTypes,f=i.SearchLoadingStates,p=u.ROLE_WORK,new(h=function(){function t(){this._loadDeletedResults=e(this._loadDeletedResults,this),this.loadMoreResults=e(this.loadMoreResults,this),this.searchApi=new o}return t.prototype.focusSearchBar=function(){return a.dispatch({type:d.FOCUS_SEARCH_BAR})},t.prototype.blurSearchBar=function(){return a.dispatch({type:d.BLUR_SEARCH_BAR})},t.prototype.setSearchQuery=function(e){var t,r,s;return t=e.path,r=e.query,s=e.user,r!==l.rawQuery()?(a.dispatch({type:d.SET_SEARCH_QUERY,data:{query:r}}),l.isSearchBarLoading()?this.searchApi.loadSuggestions({user:s,path:t,query:l.normalizedQuery(),onSuccess:this.setSearchSuggestions}):void 0):void 0},t.prototype.setSearchSuggestions=function(e){var t;return t=e.searchResults,a.dispatch({type:d.SET_SEARCH_SUGGESTIONS,data:{searchResults:t}})},t.prototype.setHighlightedRow=function(e){var t;return t=e.index,a.dispatch({type:d.SET_HIGHLIGHTED_ROW,data:{index:t}})},t.prototype.highlightPreviousRow=function(){return a.dispatch({type:d.HIGHLIGHT_PREVIOUS_ROW})},t.prototype.highlightNextRow=function(){return a.dispatch({type:d.HIGHLIGHT_NEXT_ROW})},t.prototype.runSearch=function(e){var t,r,s;return s=e.user,t=e.path,r=e.query,a.dispatch({type:d.START_SEARCH,data:{query:r}}),this.searchApi.loadResults({user:s,path:t,query:r,loadDeleted:!1,start:0,onSuccess:function(e){return function(r){var n;return n=r.searchResults,e._setSearchResults({searchResults:n}),e._loadDeletedResults({path:t,user:s})}}(this)})},t.prototype.loadMoreResults=function(e){var t,r,s;if(t=e.path,s=e.user,l.loadingState()===f.LOADED){if(l.hasMoreResults())r=!1;else{if(!l.hasMoreResults(!0))return;r=!0}return a.dispatch({type:d.CONTINUE_SEARCH,data:{didLoadDeletedResults:r}}),this.searchApi.loadResults({user:s,path:t,query:l.latestQuery(),loadDeleted:r,start:r?l.numDeletedResults():l.searchResults().size,onSuccess:function(e){return function(r){var n,o;return o=r.searchResults,n=r.deleted,e._appendSearchResults({searchResults:o,deleted:n}),e._loadDeletedResults({path:t,user:s})}}(this)})}},t.prototype._setSearchResults=function(e){var t;return t=e.searchResults,a.dispatch({type:d.SET_SEARCH_RESULTS,data:{searchResults:t}})},t.prototype._appendSearchResults=function(e){var t,r;return r=e.searchResults,t=e.deleted,a.dispatch({type:d.APPEND_SEARCH_RESULTS,data:{deleted:t,searchResults:r}})},t.prototype._loadDeletedResults=function(e){var t,r;return t=e.path,r=e.user,l.hasMoreResults()||l.didLoadDeletedResults()?void 0:this.loadMoreResults({path:t,user:r})},t.prototype.setSearchSelection=function(e){var t;return t=e.selection,a.dispatch({type:d.SET_SEARCH_SELECTION,data:{selection:t}})},t.prototype.clearSearch=function(){return a.dispatch({type:d.CLEAR_SEARCH})},t}())})}.call(this),function(){define("modules/clean/search/api",["modules/clean/ajax","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/search/constants"],function(e,t,r,s){var n,o,i,a;return o=t.File,n=r.BrowseStore,i=s.MaxResults,a=function(){function t(){this._activeRequest=null}return t.prototype.loadSuggestions=function(e){var t,r,s,n,o,a;return a=e.user,s=e.path,n=e.query,r=e.onSuccess,t=e.onError,o={query:n,fq_path:s,filename_only:!0,max_results:i.MAX_SEARCH_SUGGESTIONS},this._fetchResults(o,a,!1,r,t)},t.prototype.loadResults=function(e){var t,r,s,n,o,a,l,u;return u=e.user,n=e.path,o=e.query,t=e.loadDeleted,l=e.start,s=e.onSuccess,r=e.onError,a={query:o,fq_path:n,filename_only:!1,max_results:i.MAX_SEARCH_RESULTS,deleted:t,start:l},this._fetchResults(a,u,t,s,r)},t.prototype._fetchResults=function(t,r,s,n,o){var i;return null!=(i=this._activeRequest)&&i.abort(),this._activeRequest=e.WebRequest({url:"/ajax_fulltext_search",data:t,dataType:"json",subject_user:r,success:function(e){return n({searchResults:e.file_info,loadDeleted:s})},error:function(e,t,r){return"abort"!==t&&"function"==typeof o?o(r):void 0},complete:function(){return this._activeRequest=null}})},t}()})}.call(this),function(){define("modules/clean/search/constants",[],function(){var e;return e={},e.MaxResults={MAX_SEARCH_SUGGESTIONS:8,MAX_SEARCH_RESULTS:100},e.SearchActionTypes={SET_USER:"SET_USER",FOCUS_SEARCH_BAR:"FOCUS_SEARCH_BAR",BLUR_SEARCH_BAR:"BLUR_SEARCH_BAR",SET_SEARCH_QUERY:"SET_SEARCH_QUERY",SET_SEARCH_SUGGESTIONS:"SET_SEARCH_SUGGESTIONS",SET_HIGHLIGHTED_ROW:"SET_HIGHLIGHTED_ROW",HIGHLIGHT_PREVIOUS_ROW:"HIGHLIGHT_PREVIOUS_ROW",HIGHLIGHT_NEXT_ROW:"HIGHLIGHT_NEXT_ROW",START_SEARCH:"START_SEARCH",SET_SEARCH_RESULTS:"SET_SEARCH_RESULTS",CONTINUE_SEARCH:"CONTINUE_SEARCH",APPEND_SEARCH_RESULTS:"APPEND_SEARCH_RESULTS",CLEAR_SEARCH:"CLEAR_SEARCH",SET_SEARCH_SELECTION:"SET_SEARCH_SELECTION"},e.SearchLoadingStates={LOADED:"LOADED",LOADING_FIRST_PAGE:"LOADING_FIRST_PAGE",LOADING_ADDITIONAL_PAGE:"LOADING_ADDITIONAL_PAGE"},e})}.call(this),function(){define("modules/clean/search/dispatcher",["modules/clean/flux/dispatcher"],function(e){return e})}.call(this),function(){define("modules/clean/search/search_bar",["jquery","external/purify","external/react","external/underscore","modules/clean/filepath","modules/clean/flux/store_mixin","modules/clean/keycode","modules/clean/react/css","modules/clean/react/input","modules/clean/react/react_i18n","modules/clean/react/sprite","modules/clean/search/actions","modules/clean/search/search_helpers","modules/clean/search/store","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,r,s,n,o,i,a,l,u,c,p,d,h,f,m){var _,g,y,S,b,v,w,F,T,D,P;return _=u.R_,F=m._,T=r.createElement,D=r.addons.classSet,P=r.DOM,g=r.createClass({displayName:"SearchBar",mixins:[o(h)],propTypes:{user:r.PropTypes.object.isRequired,currentPath:r.PropTypes.string.isRequired,onSearch:r.PropTypes.func.isRequired,onFileOrFolderOpen:r.PropTypes.func.isRequired},_get_state_from_stores:function(){return{isFocused:h.isSearchBarFocused(),isActive:h.isSearchBarActive(),isSearchActive:!!h.latestQuery(),rawQuery:h.rawQuery(),normalizedQuery:h.normalizedQuery(),suggestions:h.searchSuggestions()}},_handleInputChange:function(e){return p.setSearchQuery({path:this.props.currentPath,query:e.target.value,user:this.props.user})},_handleInputKeydown:function(e){return e.keyCode===i.ESC?(p.clearSearch(),void e.target.blur()):(e.stopPropagation(),e.keyCode===i.UP?(e.preventDefault(),p.highlightPreviousRow()):e.keyCode===i.DOWN?(e.preventDefault(),p.highlightNextRow()):void 0)},_handleInputSubmit:function(e){return e.preventDefault(),0===h.highlightedSearchRow()?this.props.onSearch(this.state.normalizedQuery):this.props.onFileOrFolderOpen(h.highlightedSuggestion())},_handleHighlightDropdownItem:function(e){return p.setHighlightedRow({index:e})},render:function(){var e;return e=s.extend({onInputChange:this._handleInputChange,onInputKeydown:this._handleInputKeydown,onInputSubmit:this._handleInputSubmit,onSearchBarFocus:function(){return p.focusSearchBar()},onSearchBarBlur:function(){return p.blurSearchBar()},onHighlightDropdownItem:this._handleHighlightDropdownItem,ref:"searchBarView",highlightedRow:h.highlightedSearchRow()},this.state,this.props),T(w,e)}}),w=r.createClass({displayName:"SearchBarView",propTypes:{isSearchActive:r.PropTypes.bool.isRequired,isActive:r.PropTypes.bool.isRequired,isFocused:r.PropTypes.bool.isRequired,onFileOrFolderOpen:r.PropTypes.func.isRequired,onInputChange:r.PropTypes.func.isRequired,onInputKeydown:r.PropTypes.func.isRequired,onInputSubmit:r.PropTypes.func.isRequired,onSearch:r.PropTypes.func.isRequired,onSearchBarBlur:r.PropTypes.func.isRequired,onSearchBarFocus:r.PropTypes.func.isRequired,onHighlightDropdownItem:r.PropTypes.func.isRequired,currentPath:r.PropTypes.string.isRequired,highlightedRow:r.PropTypes.number.isRequired,suggestions:r.PropTypes.array.isRequired,rawQuery:r.PropTypes.string,normalizedQuery:r.PropTypes.string},getDefaultProps:function(){return{rawQuery:"",normalizedQuery:""}},handleNavigation:function(){var e;return e=this.refs.searchBarInput.refs.searchBarTextInput.getDOMNode(),e.blur()},render:function(){var e,t,r;return e={"search-bar":!0,"is-expanded":this.props.isSearchActive,"is-focused":this.props.isFocused,"is-active":this.props.isActive},P.div({className:"search-bar--container u-l-fr"},P.div({className:D(e)},r=T(v,{isActive:this.props.isActive,isFocused:this.props.isFocused,onFileOrFolderOpen:this.props.onFileOrFolderOpen,onInputChange:this.props.onInputChange,onInputKeydown:this.props.onInputKeydown,onInputSubmit:this.props.onInputSubmit,onSearchBarBlur:this.props.onSearchBarBlur,onSearchBarFocus:this.props.onSearchBarFocus,rawQuery:this.props.rawQuery,highlightedRow:this.props.highlightedRow,ref:"searchBarInput"}),(null!=(t=this.props.normalizedQuery)?t.length:void 0)?T(y,{onFileOrFolderOpen:function(e){return function(t){return e.props.onFileOrFolderOpen(t),e.handleNavigation()}}(this),onSearch:function(e){return function(t){return e.props.onSearch(t),e.handleNavigation()}}(this),currentPath:this.props.currentPath,highlightedRow:this.props.highlightedRow,isOpen:this.props.isFocused,normalizedQuery:this.props.normalizedQuery,onHighlightDropdownItem:this.props.onHighlightDropdownItem,ref:"searchBarDropdown",suggestions:this.props.suggestions}):void 0))}}),v=r.createClass({displayName:"SearchBarInput",propTypes:{isActive:r.PropTypes.bool.isRequired,isFocused:r.PropTypes.bool.isRequired,onFileOrFolderOpen:r.PropTypes.func.isRequired,onInputChange:r.PropTypes.func.isRequired,onInputKeydown:r.PropTypes.func.isRequired,onInputSubmit:r.PropTypes.func.isRequired,onSearchBarBlur:r.PropTypes.func.isRequired,onSearchBarFocus:r.PropTypes.func.isRequired,rawQuery:r.PropTypes.string,highlightedRow:r.PropTypes.number.isRequired},componentDidMount:function(){return e(this.refs.searchBarTextInput.getDOMNode()).on("keydown",this.props.onInputKeydown)},_onSubmit:function(e){return this.refs.searchBarTextInput.getDOMNode().blur(),this.props.onInputSubmit(e)},render:function(){return P.form({className:"search-bar__input",onSubmit:this._onSubmit},P.input({"aria-activedescendant":"search-suggestion"+this.props.highlightedRow,"aria-autocomplete":"list","aria-expanded":this.props.isFocused&&this.props.isActive,"aria-label":F("Search"),"aria-owns":"search-bar__suggestions",className:"search-bar__text-input",onChange:this.props.onInputChange,onBlur:this.props.onSearchBarBlur,onFocus:this.props.onSearchBarFocus,placeholder:F("Search"),ref:"searchBarTextInput",role:"combobox",value:this.props.rawQuery}),P.input({"aria-label":F("Search"),className:"search-bar__button",ref:"searchBarSearchButton",type:"submit",value:""}))}}),y=r.createClass({displayName:"SearchBarDropdown",propTypes:{isOpen:r.PropTypes.bool.isRequired,onFileOrFolderOpen:r.PropTypes.func.isRequired,onSearch:r.PropTypes.func.isRequired,onHighlightDropdownItem:r.PropTypes.func.isRequired,currentPath:r.PropTypes.string.isRequired,normalizedQuery:r.PropTypes.string.isRequired,suggestions:r.PropTypes.array.isRequired},render:function(){var e,t,r;return e={"search-bar__dropdown":!0,"is-expanded":this.props.isOpen},P.div({className:D(e),"aria-hidden":!this.props.isOpen},P.ul({className:"search-bar__suggestions",id:"search-bar__suggestions",role:"listbox"},T(S,{onSearch:this.props.onSearch,onHighlightDropdownItem:this.props.onHighlightDropdownItem,currentPath:this.props.currentPath,normalizedQuery:this.props.normalizedQuery,highlightedRow:this.props.highlightedRow}),function(){var e,s,n,o;if(this.props.suggestions.length){for(n=this.props.suggestions,o=[],r=e=0,s=n.length;s>e;r=++e)t=n[r],o.push(T(b,{file:t,key:t.fq_path,onFileOrFolderOpen:this.props.onFileOrFolderOpen,onHighlightDropdownItem:this.props.onHighlightDropdownItem,rank:r,highlightedRow:this.props.highlightedRow}));return o}}.call(this)),h.isSearchBarLoading()?P.div({className:"search-bar__loading"},P.span({className:"ax-visually-hidden"},F("Loading search..."))):void 0)}}),S=r.createClass({displayName:"SearchBarDropdownSearchItem",propTypes:{onSearch:r.PropTypes.func.isRequired,onHighlightDropdownItem:r.PropTypes.func.isRequired,currentPath:r.PropTypes.string.isRequired,normalizedQuery:r.PropTypes.string.isRequired,highlightedRow:r.PropTypes.number.isRequired},render:function(){var e,t;return t=0===this.props.highlightedRow,e={"search-bar__suggestion":!0,"search-bar__suggestion--is-highlighted":t},P.li({className:D(e),id:"search-dropdown-query",onMouseDown:function(e){return function(){return e.props.onSearch(e.props.normalizedQuery)}}(this),onMouseEnter:function(e){return function(){return e.props.onHighlightDropdownItem(0)}}(this),role:"option","aria-selected":t},P.div({className:"search-bar__suggestion-icon--search"}),P.div({className:"search-bar__suggestion-name"},_({current_path:n.filename(this.props.currentPath),query:this.props.normalizedQuery},"Search for ‘<strong>%(query)s</strong>’ in %(current_path)s")))}}),b=r.createClass({displayName:"SearchBarDropdownSuggestion",propTypes:{file:r.PropTypes.shape({filename_highlights:r.PropTypes.array,fq_path:r.PropTypes.string,icon:r.PropTypes.string}).isRequired,onFileOrFolderOpen:r.PropTypes.func.isRequired,onHighlightDropdownItem:r.PropTypes.func.isRequired,rank:r.PropTypes.number.isRequired,highlightedRow:r.PropTypes.number.isRequired},render:function(){var e,r,s,o,i;return r=n.filename(this.props.file.fq_path),s=d.highlightMatchString(r,this.props.file.filename_highlights),i=n.parent_dir(this.props.file.fq_path),o=this.props.rank+1,e={"search-bar__suggestion":!0,"search-bar__suggestion--is-highlighted":o===this.props.highlightedRow},P.li({className:D(e),id:"search-dropdown-suggestion"+o,role:"option",onMouseDown:function(e){return function(){return e.props.onFileOrFolderOpen(e.props.file)}}(this),onMouseEnter:function(e){return function(){return e.props.onHighlightDropdownItem(o)}}(this)},T(c,{group:"web",name:this.props.file.icon,className:"search-bar__suggestion-icon",alt:""}),P.div({className:"search-bar__suggestion-name",dangerouslySetInnerHTML:{__html:t.sanitize(s)}}),P.div({className:"search-bar__suggestion-desc"},_({location:i,comment:"Describes the parent directory of a file in a list of search results."},"<span title='%(location)s'>in %(location)s</span>")))}}),g=a(g,["/static/css/search/search_bar_react-vfl8uH_rY.css"])})}.call(this),function(){var e=function(e,r){function s(){this.constructor=e}for(var n in r)t.call(r,n)&&(e[n]=r[n]);return s.prototype=r.prototype,e.prototype=new s,e.__super__=r.prototype,e},t={}.hasOwnProperty;define("modules/clean/search/store",["external/immutable","modules/clean/ajax","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/search/constants","modules/clean/viewer","modules/core/uri"],function(t,r,s,n,o,i){var a,l,u,c,p,d;return a=n.BrowseActionTypes,l=o.File,u=i.MaxResults,c=i.SearchActionTypes,p=i.SearchLoadingStates,new(d=function(r){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,r),s.prototype._init=function(){return this._isSearchBarFocused=!1,this._isSearchBarLoading=!1,this._rawQuery="",this._normalizedQuery="",this._searchSuggestions=[],this._highlightedSearchRow=0,this._resetSearchResults()},s.prototype._resetSearchResults=function(){return this._latestQuery="",this._loadingState=p.LOADED,this._searchResults=t.List(),this._selection=new t.Record({selected:new t.OrderedSet,anchor:null})(),this._hasMoreLiveResults=!0,this._numDeletedResults=0,this._hasMoreDeletedResults=!0,this._didLoadDeletedResults=!1},s.prototype.isSearchBarFocused=function(){return this._isSearchBarFocused},s.prototype.isSearchBarActive=function(){return!!this._rawQuery},s.prototype.isSearchBarLoading=function(){return this._isSearchBarLoading},s.prototype.rawQuery=function(){return this._rawQuery},s.prototype.normalizedQuery=function(){return this._rawQuery.trim().replace(/\ +/g," ")},s.prototype.searchSuggestions=function(){return this._searchSuggestions},s.prototype.highlightedSearchRow=function(){return this._highlightedSearchRow},s.prototype.highlightedSuggestion=function(){var e,t;return t=this._highlightedSearchRow-1,e=this._searchSuggestions[t],this._searchSuggestions[t]},s.prototype.latestQuery=function(){return this._latestQuery},s.prototype.loadingState=function(){return this._loadingState},s.prototype.searchResults=function(){return this._searchResults},s.prototype.hasMoreResults=function(e){return null==e&&(e=!1),this._hasMoreLiveResults},s.prototype.numDeletedResults=function(){return this._numDeletedResults},s.prototype.didLoadDeletedResults=function(){return this._didLoadDeletedResults},s.prototype.hasMoreDeletedResults=function(){return this._hasMoreDeletedResults},s.prototype.selection=function(){return this._selection},s.prototype._focusSearchBar=function(){return this._isSearchBarFocused=!0,this._highlightedSearchRow=0,this.emit_change()},s.prototype._blurSearchBar=function(){return this._isSearchBarFocused=!1,this.emit_change()},s.prototype._setSearchQuery=function(e){var t;return t=e.query,this._rawQuery=t,this._searchSuggestions=[],this._highlightedSearchRow=0,this._isSearchBarLoading=!!this.normalizedQuery(),this.emit_change()},s.prototype._setSearchSuggestions=function(e){var t,r;return t=e.searchResults,this._isSearchBarLoading=!1,this._searchSuggestions=function(){var e,s,n;for(n=[],e=0,s=t.length;s>e;e++)r=t[e],n.push(new l(r));return n}(),this.emit_change()},s.prototype._setHighlightedSearchRow=function(e){var t;return t=e.index,this._highlightedSearchRow=t,this.emit_change()},s.prototype._highlightPreviousSearchRow=function(){return this._highlightedSearchRow=Math.max(0,this._highlightedSearchRow-1),this.emit_change()},s.prototype._highlightNextSearchRow=function(){return this._highlightedSearchRow=Math.min(this._searchSuggestions.length,this._highlightedSearchRow+1),this.emit_change()},s.prototype._startSearch=function(e){var t;return t=e.query,this._resetSearchResults(),this._rawQuery=t,this._latestQuery=this.normalizedQuery(),this._loadingState=p.LOADING_FIRST_PAGE,this.emit_change()},s.prototype._setSearchResults=function(e){var r,s;return s=e.searchResults,this._searchResults=t.List(function(){var e,t,n;for(n=[],e=0,t=s.length;t>e;e++)r=s[e],n.push(l(r));return n}()),this._loadingState=p.LOADED,this._updateMoreResults(s),this.emit_change()},s.prototype._continueSearch=function(e){var t;return t=e.didLoadDeletedResults,t&&(this._didLoadDeletedResults=!0),this._loadingState=p.LOADING_ADDITIONAL_PAGE,this.emit_change()},s.prototype._appendSearchResults=function(e){var t,r,s;return t=e.deleted,s=e.searchResults,t&&(this._numDeletedResults+=s.length),this._searchResults=this._searchResults.concat(function(){var e,t,n;for(n=[],e=0,t=s.length;t>e;e++)r=s[e],n.push(l(r));return n}()),this._loadingState=p.LOADED,this._updateMoreResults(s),this.emit_change()},s.prototype._clearSearch=function(){return this._setSearchQuery({query:""}),this._resetSearchResults(),this._rawQuery="",this._isSearchBarLoading=!1,this.emit_change()},s.prototype._updateMoreResults=function(e){var t;return t=e.length===u.MAX_SEARCH_RESULTS,this._hasMoreLiveResults?this._hasMoreLiveResults=t:this._hasMoreDeletedResults?this._hasMoreDeletedResults=t:void 0},s.prototype._setSearchSelection=function(e){var t;return t=e.selection,this._selection=t,this.emit_change()},s.prototype._new_payload=function(e){switch(e.action.type){case c.FOCUS_SEARCH_BAR:return this._focusSearchBar();case c.BLUR_SEARCH_BAR:return this._blurSearchBar();case c.SET_SEARCH_QUERY:return this._setSearchQuery(e.action.data);case c.SET_SEARCH_SUGGESTIONS:return this._setSearchSuggestions(e.action.data);case c.SET_HIGHLIGHTED_ROW:return this._setHighlightedSearchRow(e.action.data);case c.HIGHLIGHT_PREVIOUS_ROW:return this._highlightPreviousSearchRow();case c.HIGHLIGHT_NEXT_ROW:return this._highlightNextSearchRow();case c.START_SEARCH:return this._startSearch(e.action.data);case c.SET_SEARCH_RESULTS:return this._setSearchResults(e.action.data);case c.CONTINUE_SEARCH:return this._continueSearch(e.action.data);case c.APPEND_SEARCH_RESULTS:return this._appendSearchResults(e.action.data);case c.SET_SEARCH_SELECTION:return this._setSearchSelection(e.action.data);case c.CLEAR_SEARCH:return this._clearSearch();case a.SET_URL:return this._clearSearch()}},s}(s))})}.call(this),function(){define("modules/clean/sharing/models/file",["modules/clean/react/browse/constants","modules/constants/legacy"],function(e,t){var r,s;return r=e.FileTypes,s=function(e,s){var n;return e.type!==r.FOLDER?!1:(s.config.isPublicFolderEnabled||null!=s.config.publicAppToken)&&(n=e.fq_path.toLowerCase(),"/public"===n||n.startsWith("/public/"))?!1:s.isCurrentPathWriteable()&&(e.ns_id===t.root_ns||s.currentNSAllowsNesting)?!0:!1},{canConvertToSharedFolder:s}})}.call(this),function(){define("modules/constants/browse",[],function(){return window.BrowseConstants})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/dirty/react/browse/actions",["external/underscore","modules/clean/css","modules/clean/em_string","modules/clean/history","modules/clean/browse_interface","modules/clean/filepath","modules/clean/file_operations/notifications","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/dispatcher","modules/clean/react/browse/store","modules/clean/search/constants","modules/clean/search/dispatcher","modules/clean/undo","modules/constants/python","modules/constants/viewer","modules/core/browser","modules/core/exception","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","modules/dirty/react/file_viewer/controller","modules/clean/downloads"],function(t,r,s,n,o,i,a,l,u,c,p,d,h,f,m,_,g,y,S,b,v,w,F,T){var D,P,R,C,E,I,M,N,A,x,O,L,k,q,B;return D=u.BrowseActionTypes,C=u.Direction,I=u.FileTypes,M=u.LoadingStates,N=u.REACT_FILE_VIEWER_ELEMENT_ID,x=u.SEARCH_PREFIX,E=p.File,R=p.BrowseStore,O=d.SearchActionTypes,A=_.ROLE_WORK,q=y.assert,L=b._,B=b.ungettext,k=function(e){var r,s,n,o,i,a,l,u;return r=e.files,s=e.indexOfPreviewFile,u=e.user,a=e.shouldFocusComment,l=null!=(o=e.updateBrowserLocation)?o:!0,n=null!=(i=e.onCloseViewer)?i:t.noop,F.open(r,s,u,N,{fileViewTarget:m.FileViewTargetType.PRIVATE,fileViewOrigin:m.FileViewOriginType.BROWSE,fileViewAction:m.FileViewActionType.CLICK,shouldFocusCommentInput:a,disableRouting:!l,onCloseViewer:n})},new(P=function(){function r(){this.setShouldShowDeletedFiles=e(this.setShouldShowDeletedFiles,this),this.navigateToParentFolder=e(this.navigateToParentFolder,this),this.navigateToSelectedFileOrFolder=e(this.navigateToSelectedFileOrFolder,this),this.navigateToFileOrFolder=e(this.navigateToFileOrFolder,this),this.computeAndApplyDeltasFromNotServer=e(this.computeAndApplyDeltasFromNotServer,this),this.pasteClipboardFilesToCurrentPath=e(this.pasteClipboardFilesToCurrentPath,this)}return r.prototype.initializeEverything=function(e){var t,r,s,n,o,i,a,l,u;return u=e.user,i=e.path,r=e.files,l=e.urlPrefix,t=e.context,o=e.mountPoints,a=e.shouldShowDeletedFiles,s=e.fqPathsToSelect,n=e.loadingState,c.dispatch({type:D.INITIALIZE_EVERYTHING,data:{user:u,path:i,files:r,urlPrefix:l,context:t,mountPoints:o,shouldShowDeletedFiles:a,fqPathsToSelect:s,loadingState:n}})},r.prototype.load=function(e){var t,r,s;return s=e.path,r=e.files,t=e.context,c.dispatch({type:D.LOAD_PATH,data:{path:s,files:r,context:t}})},r.prototype.add=function(e){var t,r;return r=e.path,t=e.files,c.dispatch({type:D.ADD_FILES,data:{path:r,files:t}})},r.prototype.setLoadingState=function(e){var t;return t=e.loadingState,c.dispatch({type:D.SET_LOADING_STATE,data:{loadingState:t}})},r.prototype.setMountPoints=function(e){var t;return t=e.mountPoints,c.dispatch({type:D.SET_MOUNT_POINTS,data:{mountPoints:t}})},r.prototype.setPath=function(e){var t,r;return r=e.path,t=e.onPathLoaded,c.dispatch({type:D.SET_PATH,data:{path:r}}),this.setLoadingState({loadingState:M.LOADING_FIRST_PAGE}),l.loadPath({path:r,userId:R.user().id,includeDeletedFiles:R.shouldShowDeletedFiles(),pathLoadCallback:function(e){return function(r){var s,n,o;return o=r.path,n=r.files,s=r.context,e.load({path:o,files:n,context:s}),"function"==typeof t?t():void 0}}(this),filesAppendCallback:this.add,loadingStateCallback:this.setLoadingState,mountPointCallback:this.setMountPoints,onError:function(e){return function(){return"/"!==r?e.setPath({path:"/",onPathLoaded:t}):void 0}}(this)})},r.prototype.reloadCurrentPath=function(){return this.setPath({path:R.path()})},r.prototype.setUser=function(e){var t;return t=e.user,c.dispatch({type:D.SET_USER,data:{user:t}})},r.prototype.updatePreview=function(e){var t;return t=e.files,F.updateFiles(t)},r.prototype.closePreview=function(){return F.close()},r.prototype.setUrlPrefix=function(e){var t;return t=e.prefix,c.dispatch({type:D.SET_URL_PREFIX,data:{prefix:t}})},r.prototype.setUrl=function(e){var t,r,s,i,a,l;t=e.path,r=e.prefix,s=e.qargs,r===x?(l=R.user(),a=l.role===A?o.WORK_ROOT:o.PERSONAL_ROOT,r+=a,n.push_state(r,s)):(i={},"1"===n.deconstruct_url().qargs.d&&(i.d="1"),n.push_state(R.urlPrefix()+w.encode_parts(t),i),h.dispatch({type:O.CLEAR_SEARCH}))},r.prototype.copySelectedFilesToClipboard=function(){var e,t;return e=R.selectedFiles(),e&&e.size?e.some(function(e){return e.isDeleted()})?(v.error(L("Deleted files cannot be added to the clipboard")),!1):(t=B("Added %(num_items)s item to clipboard","Added %(num_items)s items to clipboard",e.size).format({num_items:e.size}),v.success(t),c.dispatch({type:D.COPY_SELECTED_FILES_TO_CLIPBOARD})):void 0},r.prototype.pasteClipboardFilesToCurrentPath=function(){return this.copyFiles({files:R.clipboardFiles().toArray(),newPath:R.path()})},r.prototype.selectRowsFromNotServer=function(e){return null==e&&(e=[]),this.setFilePathsToSelectOnNextUpdate({fqPathsToSelect:e.map(function(e){return e.fq_path;

})})},r.prototype.setFilePathsToSelectOnNextUpdate=function(e){var t;return t=e.fqPathsToSelect,c.dispatch({type:D.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE,data:{fqPathsToSelect:t}})},r.prototype.copyFiles=function(e){var t,r,s;return t=e.files,r=e.newPath,s=R.user(),l.copyFiles({files:t,newPath:r,userId:s.id,onSuccess:function(e){return function(n){var o,i;return i=n.files,o=n.changesets,a.notifyCopySuccess(t.length,s,o,r,function(){return e.selectRowsFromNotServer(t)}),e.selectRowsFromNotServer(i)}}(this)})},r.prototype.deleteFiles=function(e){var t,r;return t=e.files,r=R.user(),l.deleteFiles({files:t,userId:r.id,onSuccess:function(e){var s,n;return n=e.fileDeltas,s=e.changesets,a.notifyDeleteSuccess(t.length,r,s,function(e){return function(){return e.selectRowsFromNotServer(t)}}(this))}})},r.prototype.moveFiles=function(e){var t,r,s,n;return s=e.path,t=e.files,r=e.newPath,n=R.user(),l.moveFiles({path:s,files:t,newPath:r,userId:n.id,onSuccess:function(e){return function(s){var o,i,l;return l=s.path,i=s.fileDeltas,o=s.changesets,a.notifyMoveSuccess(t.length,n,o,r,function(){return e.selectRowsFromNotServer(t)})}}(this)})},r.prototype.showFileRename=function(e){var t;return t=e.file,c.dispatch({type:D.REQUEST_NEW_FILE_NAME,data:{file:t}})},r.prototype.cancelFileRename=function(e){var t;return t=e.file,c.dispatch({type:D.CANCEL_FILE_RENAME,data:{file:t}})},r.prototype.renameFile=function(e){var t,r,s;return t=e.file,r=e.newName,c.dispatch({type:D.SET_FILE_RENAME_PENDING,data:{file:t}}),s=R.user(),l.renameFile({file:t,newName:r,userId:s.id,onSuccess:function(e){return function(r){var n,o;return o=r.renamedFile,n=r.changesets,a.notifyRenameSuccess(s,n,function(){return e.selectRowsFromNotServer([t])}),e.selectRowsFromNotServer([o])}}(this),onError:function(e){return function(){return e.cancelFileRename({file:t})}}(this)})},r.prototype.applyFileDeltas=function(e){var t,r,s,n,o,i,a;for(i=e.path,s=e.fileDeltas,n=0,o=s.length;o>n;n++)a=s[n],r=a.before,t=a.after,q(null!=r||null!=t,"malformed delta encountered");return c.dispatch({type:D.CHANGE_FILES,data:{path:i,fileDeltas:s}})},r.prototype._getMountPointUpdateForCurrentPath=function(e){var r,s,n,o,i,a,l,u;return n=R.path(),r=(null!=(u=R.mountPoints())?u.toJS():void 0)||{},o=function(){return function(e){return e===n}}(this),s=parseInt(t.findKey(r,o),10),s?(a=e[s]||null,l=r[s]||null):(l=null,i=Boolean(t.findKey(e,o)),a=i?n:null),[l,a]},r.prototype._getPathForNewMountPoint=function(e,t){return e&&!t?R.path():e&&t?i.paths_are_equal(e,t)?null:t:!e&&t?R.path():null},r.prototype.computeAndApplyDeltasFromNotServer=function(e){var t,r,s,n,o,i,a,l,u,c,p,d,h,f,m,_,g,y,S,b,w,F,T,D,P;if(S=e.path,b=e.payload,t=b.added,m=b.moved,D=b.removed,f=b.mount_points,y=b.parent_changes,F=this._getMountPointUpdateForCurrentPath(f),n=F[0],g=F[1],n&&!g&&v.success(L("The folder was unshared.")),P=this._getPathForNewMountPoint(n,g))return void this.setPath({path:P});for(this.setMountPoints({mountPoints:f}),o=R.filesMap(),i=[],l=0,p=t.length;p>l;l++)_=t[l],s=null,r=new E(_),i.push({before:s,after:r});for(u=0,d=m.length;d>u;u++)T=m[u],w=T[0],_=T[1],s=o.get(w,null),r=new E(_),i.push({before:s,after:r});for(c=0,h=D.length;h>c;c++)a=D[c],s=o.get(a,null),r=null,i.push({before:s,after:r});return this.applyFileDeltas({path:S,fileDeltas:i})},r.prototype.setSelection=function(e){var t;return t=e.selection,c.dispatch({type:D.SET_SELECTION,data:{selection:t}})},r.prototype.selectFilesByFqPath=function(e){var t;return t=e.fqPathsToSelect,c.dispatch({type:D.SELECT_FILES_BY_FQ_PATH,data:{fqPathsToSelect:t}})},r.prototype.toggleFqPathSelected=function(e){var t;return t=e.path,c.dispatch({type:D.TOGGLE_FQ_PATH_SELECTED,data:{path:t}})},r.prototype.navigateToFileOrFolder=function(e){var t,r,s,n,o,i;return t=e.file,i=null!=(n=e.shouldFocusComment)?n:!1,t.is_dir?this.setUrl({path:t.fq_path}):(r=R.getIndexOfFile(t),r>-1?s=null!=(o=R.files())?o.toJS():void 0:(r=0,s=[t]),"download"===t.preview_type?g.unsafe_open_tab(t.href):k({files:s,indexOfPreviewFile:r,shouldFocusComment:i,user:R.user()}))},r.prototype.openPreviewForFile=function(e){var t,r;return t=e.file,r=e.onCloseViewer,k({files:[t],indexOfPreviewFile:0,user:R.user(),updateBrowserLocation:!1,onCloseViewer:function(){return"function"==typeof r?r():void 0}})},r.prototype.navigateToSelectedFileOrFolder=function(){var e;return e=R.selectedFiles(),1===e.count()?this.navigateToFileOrFolder({file:e.first()}):void 0},r.prototype.navigateToParentFolder=function(){var e;return e=i.parent_dir(R.path()),this.setUrl({path:e})},r.prototype.setShouldShowDeletedFiles=function(e){var t,r,s;return s=e.shouldShowDeletedFiles,r=null!=(t=e.shouldReloadFolder)?t:!0,s?n.update_query_param("d","1"):n.remove_query_param("d"),c.dispatch({type:D.SET_SHOULD_SHOW_DELETED_FILES,data:{shouldShowDeletedFiles:s}}),r?this.reloadCurrentPath():void 0},r.prototype.sortFiles=function(e){var t,r;return r=e.sortField,t=e.direction,c.dispatch({type:D.SORT_FILES,data:{sortField:r,direction:t}})},r.prototype.setCopyMode=function(e){var t;return t=e.copyMode,c.dispatch({type:D.SET_COPY_MODE,data:{copyMode:t}})},r.prototype.downloadCurrentlySelectedFiles=function(){var e,t,r,s,n,o,i;return o=R.selectedFiles(),i=R.user(),e=R.context(),n=R.path(),1===o.count()?(r=o.first(),r.is_dir?T.get_zip({fq_paths:[r.fq_path],subject_uid:i.id,block_hash:e.blockHash,parent_path:n}):T.get_blockserver_link({url:r.direct_blockserver_link})):(s=function(){var e,r,s,n;for(s=o.toArray(),n=[],e=0,r=s.length;r>e;e++)t=s[e],n.push(t.fq_path);return n}(),T.get_zip({fq_paths:s,subject_uid:i.id,block_hash:e.blockHash,parent_path:n}))},r.prototype.toggleShortcutsMenu=function(){return c.dispatch({type:D.TOGGLE_SHORTCUTS_MENU})},r.prototype.nameNewFolder=function(){return c.dispatch({type:D.REQUEST_FOLDER_NAME})},r.prototype.createFolder=function(e){var t,r,s;return r=e.pathName,t=e.folderName,c.dispatch({type:D.CREATE_FOLDER_PENDING}),s=R.user(),l.createNewFolder({pathName:r,folderName:t,userId:s.id,onSuccess:function(e){return function(r){var n,o;return n=r.changesets,o=r.createdFolder,c.dispatch({type:D.CREATE_FOLDER_COMPLETE}),a.notifyFolderCreationSuccess(t,s,n),e.selectRowsFromNotServer([o])}}(this),onError:function(){return c.dispatch({type:D.CANCEL_CREATE_FOLDER})}})},r.prototype.cancelCreateFolder=function(){return c.dispatch({type:D.CANCEL_CREATE_FOLDER})},r.prototype.addCommentStatusBatch=function(e){var t;return t=e.commentStatusByFqPath,c.dispatch({type:D.ADD_COMMENT_STATUS_BATCH,data:{commentStatusByFqPath:t}})},r.prototype.startInternalDrag=function(){return c.dispatch({type:D.START_INTERNAL_DRAG})},r.prototype.stopInternalDrag=function(){return c.dispatch({type:D.STOP_INTERNAL_DRAG})},r.prototype.setDropTarget=function(e){var t;return t=e.target,c.dispatch({type:D.SET_DROP_TARGET,data:{target:t}})},r.prototype.dropInternalFiles=function(e){var t,r;return r=e.target,t=e.isCopying,this.stopInternalDrag(),t?this.copyFiles({files:R.selectedFiles().toArray(),newPath:r.fq_path}):this.moveFiles({path:R.path(),files:R.selectedFiles().toArray(),newPath:r.fq_path})},r}())})}.call(this),function(){define("modules/dirty/react/browse/browse",["jquery","external/immutable","external/react","external/underscore","external/classnames","modules/clean/browse_interface","modules/clean/em_string","modules/clean/flux/store_mixin","modules/clean/history","modules/clean/notserver","modules/clean/pagination_manager","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/internal_drag_status","modules/clean/react/browse/keyboard_shortcuts","modules/clean/react/browse/store","modules/clean/react/css","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/uploader","modules/clean/react/file_uploader/store","modules/clean/react/outside_event","modules/clean/search/actions","modules/clean/search/search_bar","modules/clean/search/store","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/comments_panel","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","modules/dirty/react/browse/actions","modules/dirty/react/browse/browse_location","modules/dirty/react/browse/comment_status","modules/dirty/react/browse/context_menu","modules/dirty/react/browse/file_list","modules/dirty/react/browse/global_actions","modules/dirty/react/browse/selection_actions","modules/dirty/react/browse/preview_sf_members","modules/dirty/react/file_viewer/controller","modules/dirty/search/search_results","modules/dirty/sharing/browse_ui_util"],function(e,t,r,s,n,o,i,a,l,u,c,p,d,h,f,m,_,g,y,S,b,v,w,F,T,D,P,R,C,E,I,M,N,A,x,O,L,k,q,B,U,H){var V,G,W,Q,j,K,z,Y,X,J,Z,$,ee,te,re,se,ne,oe,ie,ae,le,ue,ce,pe,de,he,fe,me;return ne=u.NotClients,ae=d.REACT_FILE_VIEWER_ELEMENT_ID,Y=d.DropTargetHighlightMode,Z=d.FileTypes,re=d.LoadingStates,se=d.NameSpaceAccess,ue=d.ShareFolderModalTypes,le=d.SEARCH_PREFIX,te=h.InternalDragStatus,j=m.BrowseStore,X=m.File,G=m.BrowseContext,ce=g.UploaderActions,$=y.FileUploader,pe=S.UploaderStore,oe=b.OutsideMouseDownHandler,de=C._,W=x.BrowseContextMenu,J=O.FileListController,ee=L.GlobalActions,Q=k.BrowseSelectionMenu,ie=q.PreviewSFMembersPanel,me=H.showTiburonUIIfAllowed,fe=r.DOM,he=r.createElement,V=r.createClass({displayName:"BrowseAppController",mixins:[a(j,pe,F)],propTypes:{"init-data":r.PropTypes.object,"notify-path-does-not-exist":r.PropTypes.string,"notify-path-is-deleted":r.PropTypes.string,"share-link":r.PropTypes.bool},_get_state_from_stores:function(){return{context:j.context(),files:j.files(),loadingState:j.loadingState(),path:j.path(),selection:j.selection(),selectedFiles:j.selectedFiles(),fileRename:j.fileRename(),user:j.user(),shouldShowDeletedFiles:j.shouldShowDeletedFiles(),isDraggingInternalFiles:j.isDraggingInternalFiles(),isDraggingExternalFiles:j.isDraggingExternalFiles(),activeDropTarget:j.activeDropTarget(),isUploadModalOpen:pe.isUploadModalOpen(),isTextSelectable:!!j.fileRename(),inCopyMode:j.inCopyMode(),isShortcutsMenuVisible:j.isShortcutsMenuVisible(),createNewFolderState:j.newFolderCreationState(),isSearchMode:!!F.latestQuery()}},_preloadLargeModules:function(){return require(["dropbox"])},componentWillMount:function(){var e,t,r,s,n,i,a,u,d,h,f,m,_,g,y,S,b,v;return this.previousHistoryCallbackPath=null,this.hasLoadedFilesForTheVeryFirstTime=!1,v=T.get_viewer().get_user_by_id(this.props["user-id"]),b=o.get_browse_root(v),t=l.deconstruct_url(),_=this.props["init-fq-path"]||"/",g=Boolean(this.props["should-show-deleted-files"]),this._setupFileEventListener(v.id),a=this.props["init-data"],a?(e=p.extractBrowseContext(a),d=Boolean(a.paginated)?re.LOADING_REMAINING_PAGES:re.LOADED,u=d===re.LOADING_REMAINING_PAGES,r=u?[]:a.file_info,h=a.ns_id_to_mount_point,s=this.props["select-fq-paths"],M.initializeEverything({user:v,path:_,files:r,urlPrefix:b,context:e,mountPoints:h,fqPathsToSelect:s,loadingState:d,shouldShowDeletedFiles:g}),u&&(m=new c,f=function(e,t){return M.add({path:_,files:t}),e.areAllItemsReady()?(M.setLoadingState({loadingState:re.LOADED}),e.stopAutoFetching()):void 0},m.initialize(a.first_page,"sjid","/browse_get_next",v.id,f),("undefined"==typeof RUNNING_IN_REACTSERVER||null===RUNNING_IN_REACTSERVER)&&m.startAutoFetching())):(M.setUrlPrefix({prefix:b}),M.setUser({user:v}),M.setShouldShowDeletedFiles({shouldShowDeletedFiles:g,shouldReloadFolder:!1}),s=this.props["select-fq-paths"],M.setFilePathsToSelectOnNextUpdate({fqPathsToSelect:s}),this.hasTTIBeenLogged=!1,this.props["search-query"]||this.navigateToPath(_)),this.props["search-query"]||(i=Boolean(this.props["preview-file-info"]),i||(S=this._getUrlForFQPath(_),this._sanitizeBrowserLocation(S))),n=Boolean(this.props["search-query"]),y=!n,l.add_callback(b,this.handleFileLocationChange,!0),l.add_callback(le,this.handleSearchLocationChange,y),this.setState(this._get_state_from_stores())},componentDidMount:function(){var e,t,r,s;return this.props["init-data"]&&(this.hasTTIBeenLogged||(D.mark_time_to_view(),D.mark_time_to_interactive(),this.hasTTIBeenLogged=!0,this._preloadLargeModules())),this._mountFileViewerTarget(),t=this.props["initial-share-modal-type"],s=this.props["preview-file-info"],s?(r=new X(s),M.openPreviewForFile({file:r,onCloseViewer:this._restoreUrlAfterFileViewClose}),t&&me(this.state.user,r,{prefillEmail:this.props["share-prefill-email"]})):t&&this._showShareModal(t,this.state.path,this.state.user),this._maybeShowLegacySharedLinkModalIfQargPresent(),null!=this.props["notify-path-is-deleted"]?(e=de("The folder ‘%(folder_name)s’ is deleted.").format({folder_name:i.em_snippet(this.props["notify-path-is-deleted"],15)}),E.error(e)):null!=this.props["notify-path-does-not-exist"]&&(e=de("The folder ‘%(folder_name)s’ doesn’t exist.").format({folder_name:i.em_snippet(this.props["notify-path-does-not-exist"],15)}),E.error(e)),P.ALLOW_STATUS_IN_BROWSE?A.setup():void 0},componentWillUpdate:function(e,t){return t.files.equals(this.state.files)?void 0:setTimeout(function(e){return function(){return e.handleFileListUpdated()}}(this),0)},_restoreUrlAfterFileViewClose:function(){var e,t;return t=this._getUrlForFQPath(this.state.path),Boolean(this.props["loaded-with-explicit-preview"])?(e=l.deconstruct_url().qargs,delete e.preview):e={},l.replace_state(t,e)},_getUrlForFQPath:function(e){var t;return t="/"===e?"":I.encode_parts(e),j.urlPrefix()+t},_sanitizeBrowserLocation:function(e){var t,r;return t=l.deconstruct_url().qargs,r=s.pick(t,"d","select","preview"),l.replace_state(e,r)},_mountFileViewerTarget:function(){var e;return e=document.getElementById(ae),e?void 0:(e=document.createElement("div"),e.id=ae,document.body.insertBefore(e,document.body.children[0]))},_showShareModal:function(e,t,r){return me(r,{fqPath:this.props["init-fq-path"],isFolder:!0,nsId:this.props["ns-id"]&&this.props["ns-path"]?this.props["ns-id"]:null,targetNsId:this.props["ns-id"]&&!this.props["ns-path"]?this.props["ns-id"]:null,prefillEmail:this.props["share-prefill-email"]})?void 0:require(["dropbox"],function(s){var n;switch(n=s.SharingModals,e){case ue.ShareExisting:return n.show_share_existing_modal(t,r);case ue.EditShared:return n.show_shared_folder_options_modal(t,r);case ue.EditSharedSubFolder:return n.show_shared_subfolder_modal(t,r)}})},_setupFileEventListener:function(e){var t,r;return r=ne[e],t=r.subscribe_sfj({name:"BrowseEventDispatcher",handler:function(s){return function(){var n;return n=s.state.path,p.getChangesForDirectory({path:n,userId:e,namespaceToJournalIdMap:r.get_ns_map(),includeDeletedFiles:s.state.shouldShowDeletedFiles,onSuccess:function(e){return M.computeAndApplyDeltasFromNotServer({payload:e,path:n}),r.handler_success(t,{ns_map:e.ns_map})}})}}(this)})},_maybeShowLegacySharedLinkModalIfQargPresent:function(){var e,t;return this.props["share-link"]&&1===this.state.selectedFiles.count()?(e=this.state.selectedFiles.toArray()[0].fq_path,t=this.state.user,require(["dropbox"],function(r){var s;return s=r.SharingModals,s.show_share_existing_modal(e,t)})):void 0},handleFileLocationChange:function(e){return e="undefined"!=typeof RUNNING_IN_REACTSERVER&&null!==RUNNING_IN_REACTSERVER?this.props["init-fq-path"]||"/":"/"+I.decode(e),e!==this.previousHistoryCallbackPath?(this.previousHistoryCallbackPath=e,e!==j.path()?(this.navigateToPath(e),v.clearSearch()):void 0):void 0},handleSearchLocationChange:function(e,t){var r,s,n;return r=(null!=t?t.query:void 0)||(null!=t?t.query_unnormalized:void 0),r&&r!==F.latestQuery()?(e=t.path||t.last_fq_path||"/",n=null!=(s=this.state.user)?s:T.get_viewer().get_user_by_id(this.props["user-id"]),v.runSearch({user:n,path:e,query:r})):void 0},navigateToPath:function(e){var t;return t=function(e){return function(){return e.hasTTIBeenLogged?void 0:(D.mark_time_to_view(),D.mark_time_to_interactive(),e.hasTTIBeenLogged=!0,e._preloadLargeModules(),e._maybeShowLegacySharedLinkModalIfQargPresent())}}(this),M.setPath({path:e,onPathLoaded:t})},handleFileListUpdated:function(){return B.isShown()?this.state.files.isEmpty()?M.closePreview():M.updatePreview({files:this.state.files.toJS()}):void 0},render:function(){var e,t;return e=this.props["sync-vars"],e.sync_user_role=this.state.user.role,t=s.extend({},{syncVars:e},this.state),he(z,t)}}),K=r.createClass({displayName:"BrowseView",mixins:[r.addons.PureRenderMixin],propTypes:{context:r.PropTypes.instanceOf(G).isRequired,files:r.PropTypes.instanceOf(t.List).isRequired,loadingState:r.PropTypes.oneOf(s.values(re)),path:r.PropTypes.string.isRequired,selection:r.PropTypes.object,selectedFiles:r.PropTypes.instanceOf(t.OrderedSet),user:r.PropTypes.object,shouldShowDeletedFiles:r.PropTypes.bool.isRequired,isDraggingInternalFiles:r.PropTypes.bool,isDraggingExternalFiles:r.PropTypes.bool,activeDropTarget:r.PropTypes.instanceOf(X),isUploadModalOpen:r.PropTypes.bool.isRequired,isTextSelectable:r.PropTypes.bool.isRequired,inCopyMode:r.PropTypes.bool.isRequired,isShortcutsMenuVisible:r.PropTypes.bool,isSearchMode:r.PropTypes.bool,syncVars:r.PropTypes.object},getDefaultProps:function(){return{selectedFiles:t.OrderedSet()}},componentDidMount:function(){return this._maybeRenderSyncFolderModal()},componentDidUpdate:function(){return this.props.isDraggingInternalFiles?(e("html").addClass("unselectable"),this.props.inCopyMode?e("html").removeClass("globalGrabbingCursor").addClass("globalCopyCursor"):e("html").removeClass("globalCopyCursor").addClass("globalGrabbingCursor")):e("html").removeClass("globalGrabbingCursor globalCopyCursor unselectable")},componentWillUnmount:function(){return this._unmountFileViewerTarget(),P.ALLOW_STATUS_IN_BROWSE?A.teardown():void 0},_maybeRenderSyncFolderModal:function(){var e;return(null!=(e=this.props.syncVars)?e.sync_ns_id:void 0)?require(["dropbox"],function(e){return function(t){var r;return r=t.SharingModel,r.show_shared_content_sync_modal("can_edit",e.props.syncVars.sync_ns_id,e.props.syncVars.sync_folder_name,e.props.syncVars.sync_folder_size,e.props.syncVars.sync_user_role,e.props.syncVars.sync_out_of_quota)}}(this)):void 0},_unmountFileViewerTarget:function(){var e;return e=document.getElementById(ae),e?document.body.removeChild(e):void 0},_getCurrentDropTargetHighlightMode:function(){var e;return!this.props.context.isInsideSharedFolder||(e=this.props.context.currentSharedFolderPermissionRole)!==se.ACCESS_NO_ACCESS&&e!==se.ACCESS_READER?this.props.isDraggingInternalFiles?this.props.selectedFiles.count(function(e){return e.isDeleted()})?Y.NONE:this.props.selectedFiles.count(function(e){return e.type===Z.TEAM_SHARED_FOLDER})?Y.NONSELECTED_NONSHARED_NONTEAM_FOLDERS:this.props.selectedFiles.count(function(e){return e.type===Z.SHARED_FOLDER})?Y.NONSELECTED_NONSHARED_FOLDERS:Y.NONSELECTED_FOLDERS:this.props.isDraggingExternalFiles&&!this.props.isUploadModalOpen?Y.ALL_FOLDERS:Y.NONE:Y.NONE},showFileUploader:function(){var e;return this.refs.contextMenu.closeMenu(),null!=(e=this.refs.fileUploader)?e.showModal():void 0},openContextMenuAtPosition:function(e,t){return this.refs.contextMenu.openMenuAtPosition(e,t)},handleSelectionChange:function(e){return M.setSelection({selection:e})},_handleSearch:function(e){return M.setUrl(e?{prefix:le,qargs:{path:j.path(),query:e}}:{path:j.path()})},_handleSearchSuggestionOpen:function(e){return M.navigateToFileOrFolder({file:e})},_renderKeyboardShortcuts:function(){return this.props.isShortcutsMenuVisible?he(f):void 0},_renderSearchResults:function(e){return he(U,{path:this.props.path,user:this.props.user,searchBarElement:e})},render:function(){var e,r,s,o;return o=he(w,{user:this.props.user,currentPath:this.props.path,isSearchActive:this.props.isSearchMode,onSearch:this._handleSearch,onFileOrFolderOpen:this._handleSearchSuggestionOpen}),this.props.isSearchMode?this._renderSearchResults(o):(s=this.props.context.isInFolderMode&&this.props.context.isInsideSharedFolder&&!this.props.context.isInsideDeletedFolder&&this.props.loadingState!==re.LOADING_FIRST_PAGE,e={list_view:!0,"file-browse":!0,"has-preview-sf-members":s},fe.div({id:"browse-box",className:n(e)},this._renderKeyboardShortcuts(),fe.div({id:"browse-header",className:"browse-header"},fe.div({id:"browse-global-actions-bar",className:"browse__global-actions clearfix u-mar-bottom-m"},he(N,{path:this.props.path,user:this.props.user,selectedFiles:this.props.selectedFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,shouldHighlightDropTargets:this.props.isDraggingInternalFiles||this.props.isDraggingExternalFiles&&!this.props.isUploadModalOpen}),o,fe.div({id:"browse-rightmenu",className:"u-l-fr"},r=null!=this.props.context.currentFQPath,this.props.user&&r?[he(ee,{shouldShowDeletedFiles:this.props.shouldShowDeletedFiles,isActionsBarDisabled:this.props.loadingState===re.LOADING_FIRST_PAGE,context:this.props.context,user:this.props.user,onFileUpload:this.showFileUploader,key:0}),he($,{ref:"fileUploader",key:1})]:void 0)),s?he(ie,{context:this.props.context,user:this.props.user}):void 0),he(Q,{selectedFiles:this.props.selectedFiles,user:this.props.user,context:this.props.context}),he(J,{files:this.props.files,selection:this.props.selection,selectedFiles:this.props.selectedFiles,onSelectionChange:this.handleSelectionChange,fileRename:this.props.fileRename,user:this.props.user,context:this.props.context,loadingState:this.props.loadingState,isShortcutsMenuVisible:this.props.isShortcutsMenuVisible,isTextSelectable:this.props.isTextSelectable,shouldShowDeletedFiles:this.props.shouldShowDeletedFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isDraggingExternalFiles:this.props.isDraggingExternalFiles,activeDropTarget:this.props.activeDropTarget,dropTargetHighlightMode:this._getCurrentDropTargetHighlightMode(),createNewFolderState:this.props.createNewFolderState,openContextMenuAtPosition:this.openContextMenuAtPosition}),he(W,{user:this.props.user,selectedFiles:this.props.selectedFiles,context:this.props.context,shouldShowDeletedFiles:this.props.shouldShowDeletedFiles,onFileUpload:this.showFileUploader,ref:"contextMenu"}),this.props.isDraggingInternalFiles?he(te,{files:t.List(this.props.selectedFiles)}):void 0))}}),z=_(K,["/static/css/browse/browse-vflyaF8OY.css"]),{BrowseApp:V}})}.call(this),function(){define("modules/dirty/react/browse/browse_location",["jquery","external/immutable","external/react","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/clean/filepath","modules/clean/viewer","modules/clean/react/browse/store","modules/dirty/react/browse/actions","modules/clean/em_string","modules/clean/react/bubble_menu","modules/core/i18n","modules/clean/react/file_uploader/actions"],function(e,t,r,s,n,o,i,a,l,u,c,p,d){var h,f,m,_,g,y,S,b,v,w,F,T,D,P,R,C,E;return g=a.BrowseStore,y=c.BubbleMenu,S=c.BubbleMenuItem,P=p._,D=d.UploaderActions,E=r.DOM,R=r.createElement,C=r.addons.classSet,v=2.625,w=20,b=1.64,F=37,_=r.createClass({displayName:"BrowseLocation",mixins:[r.addons.PureRenderMixin],propTypes:{path:r.PropTypes.string,user:r.PropTypes.object,selectedFiles:r.PropTypes.instanceOf(t.OrderedSet),isDraggingInternalFiles:r.PropTypes.bool,shouldHighlightDropTargets:r.PropTypes.bool},getDefaultProps:function(){return{path:"/",selectedFiles:t.OrderedSet(),isDraggingInternalFiles:!1,shouldHighlightDropTargets:!1}},_generateBreadcrumbData:function(){var e,t,r,s,n,a,l,c,p,d,h,f,m,_,g,y,S;for(r=function(){var e,r,s,n;for(s=this.props.path.split("/"),n=[],e=0,r=s.length;r>e;e++)t=s[e],t.length>0&&n.push(t);return n}.call(this),e=[{path:"",folderName:o.filename("",i.get_root_name(this.props.user)),icon:"work"===this.props.user.role?"work_icon":"personal_icon",alt:P("work"===this.props.user.role?"Work":"Personal")}],s=n=0,h=r.length;h>=0?h>n:n>h;s=h>=0?++n:--n)d="/"+r.slice(0,s+1).join("/"),e.push({path:d,folderName:o.filename(d),icon:"folder_32",alt:P("Folder")});if(e.length<3)return{dropdownCrumbs:[],inlineCrumbs:e,root:e[0]};for(g=null!=(f=null!=(m=e[0])?m.folderName:void 0)?f:"",l=this._getMaxBreadcrumbWidth(g,!1),S=function(){var r,s,n,o;for(o=[],r=0,s=e.length;s>r;r++)t=e[r],o.push(new u(null!=(n=t.folderName)?n:"").length);return o}(),p=1,y=S[e.length-1],s=a=_=e.length-2;(1>=_?1>=a:a>=1)&&(y+=b,y+=S[s],!(y>l));s=1>=_?++a:--a)p+=1;return e.length===p+1&&(p+=1),c=e.length-p,{dropdownCrumbs:e.slice(0,c),inlineCrumbs:e.slice(c),root:e[0]}},_getMaxBreadcrumbWidth:function(e,t){var r;return r=t?v:new u(e).length,w-r},render:function(){var t,r,s,n,i,a,l,u,c;return l=this._generateBreadcrumbData(),s=l.dropdownCrumbs,i=l.inlineCrumbs,c=l.root,a=this._getMaxBreadcrumbWidth(null!=(u=null!=c?c.folderName:void 0)?u:"",s.length>0),t="page-header-text u-l-fl",i.length>1||s.length>0?E.span({},E.h1({className:"ax-visually-hidden"},o.filename(this.props.path)),E.nav({className:t,id:"browse-location","aria-label":P("Folder hierarchy"),role:"navigation"},s.length>0?R(h,{crumbs:s,currentPath:this.props.path,selectedFiles:this.props.selectedFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,shouldHighlightDropTargets:this.props.shouldHighlightDropTargets}):void 0,function(){var t,o,l;for(l=[],n=t=0,o=i.length;o>t;n=++t)r=i[n],l.push(R(m,e.extend({},r,{key:r.path,isOnlyCrumb:0===n&&1===i.length&&0===s.length,isLastCrumb:n===i.length-1,maxWidth:a,currentPath:this.props.path,selectedFiles:this.props.selectedFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isHighlightedDropTarget:this.props.shouldHighlightDropTargets})));return l}.call(this))):E.h1({className:t},o.filename(this.props.path))}}),T=r.createClass({displayName:"Spacer",render:function(){return E.span({}," ",R(s,{group:"web",name:"chevron",className:"breadcrumb__spacer",alt:""})," ")}}),m=r.createClass({displayName:"BreadCrumbSegment",propTypes:{path:r.PropTypes.string.isRequired,folderName:r.PropTypes.string.isRequired,isLastCrumb:r.PropTypes.bool.isRequired,isOnlyCrumb:r.PropTypes.bool,maxWidth:r.PropTypes.number.isRequired,currentPath:r.PropTypes.string.isRequired,selectedFiles:r.PropTypes.instanceOf(t.OrderedSet),isDraggingInternalFiles:r.PropTypes.bool,isHighlightedDropTarget:r.PropTypes.bool},getDefaultProps:function(){return{isOnlyCrumb:!1,isDraggingInternalFiles:!1,isHighlightedDropTarget:!1,selectedFiles:t.OrderedSet()}},getInitialState:function(){return{isDraggedOver:!1}},handleMouseEnter:function(){return this.props.isDraggingInternalFiles?this.setState({isDraggedOver:!0}):void 0},handleMouseLeave:function(){return this.state.isDraggedOver?this.setState({isDraggedOver:!1}):void 0},handleMouseUp:function(e){return this.state.isDraggedOver&&this.setState({isDraggedOver:!1}),this.props.isDraggingInternalFiles&&!this.props.isLastCrumb?(e.preventDefault(),e.stopPropagation(),e.ctrlKey||e.altKey?l.copyFiles({files:this.props.selectedFiles.toArray(),newPath:this.props.path}):l.moveFiles({path:this.props.currentPath,files:this.props.selectedFiles.toArray(),newPath:this.props.path}),l.stopInternalDrag()):void 0},componentDidMount:function(){var t,r;return t=0,r=null,e(this.getDOMNode()).on("dragenter.breadcrumb",function(e){return function(s){return s.preventDefault(),s.target!==r?(r=s.target,t+=1,e.setState({isDraggedOver:!0}),e.props.isLastCrumb?void 0:D.setPath({path:e.props.path})):void 0}}(this)).on("dragleave.breadcrumb",function(e){return function(s){return s.preventDefault(),r=null,t-=1,1>t&&(t=0,e.state.isDraggedOver)?(D.setPath({path:e.props.path}),e.setState({isDraggedOver:!1})):void 0}}(this)).on("drop.breadcrumb",function(e){return function(){return e.setState({isDraggedOver:!1})}}(this)).on("dragover.breadcrumb",function(e){return e.preventDefault(),e.stopPropagation()}).on("mouseenter.breadcrumb",this.handleMouseEnter).on("mouseleave.breadcrumb",this.handleMouseLeave).on("mouseup.breadcrumb",this.handleMouseUp)},componentWillUnmount:function(){return e(this.getDOMNode()).off(".breadcrumb")},render:function(){var e,t;return t=this.props.isOnlyCrumb?this.props.folderName:u.em_snippet(this.props.folderName,this.props.maxWidth),e={"breadcrumb-segment--is-drop-target":!this.props.isLastCrumb&&this.props.isHighlightedDropTarget,"breadcrumb-segment--file-dragged-over":!this.props.isLastCrumb&&this.state.isDraggedOver},this.props.isLastCrumb?E.span({},t):E.span({},E.a({href:this.props.path,onClick:this.navigateToFolder,className:C(e)},t),R(T))},navigateToFolder:function(e){return e.preventDefault(),l.setUrl({path:this.props.path})}}),f=r.createClass({displayName:"BreadCrumbDropdownMenuItem",propTypes:{path:r.PropTypes.string.isRequired,icon:r.PropTypes.string.isRequired,folderName:r.PropTypes.string.isRequired,alt:r.PropTypes.string,isHighlightedDropTarget:r.PropTypes.bool,closeFunc:r.PropTypes.func,isDraggingInternalFiles:r.PropTypes.bool,selectedFiles:r.PropTypes.instanceOf(t.OrderedSet),currentPath:r.PropTypes.string.isRequired},getDefaultProps:function(){return{isHighlightedDropTarget:!1,closeFunc:function(){},alt:"",isDraggingInternalFiles:!1,selectedFiles:t.OrderedSet()}},getInitialState:function(){return{isDraggedOver:!1}},handleMouseEnter:function(){return this.props.isDraggingInternalFiles?this.setState({isDraggedOver:!0}):void 0},handleMouseLeave:function(){return this.state.isDraggedOver?this.setState({isDraggedOver:!1}):void 0},handleMouseUp:function(e){return this.state.isDraggedOver&&this.setState({isDraggedOver:!1}),this.props.isDraggingInternalFiles&&!this.props.isLastCrumb?(e.preventDefault(),e.stopPropagation(),e.ctrlKey||e.altKey?l.copyFiles({files:this.props.selectedFiles.toArray(),newPath:this.props.path}):l.moveFiles({path:this.props.currentPath,files:this.props.selectedFiles.toArray(),newPath:this.props.path}),l.stopInternalDrag(),this.props.closeFunc()):void 0},componentDidMount:function(){var t,r;return t=0,r=null,e(this.getDOMNode()).on("dragenter.breadcrumbMenuItem",function(e){return function(s){return s.preventDefault(),s.target!==r?(r=s.target,t+=1,e.setState({isDraggedOver:!0}),D.setPath({path:e.props.path})):void 0}}(this)).on("dragleave.breadcrumbMenuItem",function(e){return function(s){return s.preventDefault(),r=null,t-=1,1>t&&(t=0,e.state.isDraggedOver)?(D.setPath({path:e.props.path}),e.setState({isDraggedOver:!1})):void 0}}(this)).on("drop.breadcrumbMenuItem",function(e){return function(){return e.setState({isDraggedOver:!1})}}(this)).on("dragover.breadcrumbMenuItem",function(e){return e.preventDefault(),e.stopPropagation()}).on("mouseenter.breadcrumbMenuItem",this.handleMouseEnter).on("mouseleave.breadcrumbMenuItem",this.handleMouseLeave).on("mouseup.breadcrumbMenuItem",this.handleMouseUp)},componentWillUnmount:function(){return e(this.getDOMNode()).off(".breadcrumbMenuItem")},handleCrumbClick:function(e){return e.preventDefault(),l.setUrl({path:this.props.path})},render:function(){var e;return e={"breadcrumb-menu-item":!0,"breadcrumb-menu-item--is-drop-target":this.props.isHighlightedDropTarget,"breadcrumb-menu-item--file-dragged-over":this.state.isDraggedOver},R(S,{onClick:this.handleCrumbClick,closeFunc:this.props.closeFunc,className:C(e)},E.span({className:"force-no-break"},R(n,{group:"web",name:this.props.icon,alt:this.props.alt,text:u.em_snippet(this.props.folderName,F)})))}}),h=r.createClass({displayName:"BreadCrumbDropdown",propTypes:{crumbs:r.PropTypes.array.isRequired,currentPath:r.PropTypes.string.isRequired,shouldHighlightDropTargets:r.PropTypes.bool,selectedFiles:r.PropTypes.instanceOf(t.OrderedSet),isDraggingInternalFiles:r.PropTypes.bool},getDefaultProps:function(){return{shouldHighlightDropTargets:!1,selectedFiles:t.OrderedSet(),isDraggingInternalFiles:!1}},componentDidMount:function(){return e(this.getDOMNode()).on("dragenter.breadcrumbDropdown",function(e){return function(t){return t.preventDefault(),e.refs.bubbleMenu.show()}}(this)).on("mouseenter.breadcrumbDropdown",function(e){return function(t){return e.props.isDraggingInternalFiles?(t.preventDefault(),e.refs.bubbleMenu.show()):void 0}}(this))},componentWillUnmount:function(){return e(this.getDOMNode()).off(".breadcrumbDropdown")},render:function(){var e,t,r,n;return t=this.props.crumbs,t.reverse(),n=E.button({className:"u-unbutton breadcrumb-overflow-button u-l-fl"},R(s,{
group:"web",name:"folder_arrow_32",alt:P("Show parent folders (descending)")})),r=function(){var r,s,n;for(n=[],r=0,s=t.length;s>r;r++)e=t[r],n.push(R(f,{key:e.path,path:e.path,icon:e.icon,alt:e.alt,folderName:e.folderName,currentPath:this.props.currentPath,isHighlightedDropTarget:this.props.shouldHighlightDropTargets,isDraggingInternalFiles:this.props.isDraggingInternalFiles,selectedFiles:this.props.selectedFiles}));return n}.call(this),E.span({},R(y,{ref:"bubbleMenu",arrow_position:"top-left",targetButton:n,items:r}),R(T))}}),_})}.call(this),function(){define("modules/dirty/react/browse/context_menu",["external/immutable","external/react","external/underscore","modules/dirty/react/browse/file_actions","modules/dirty/react/browse/global_actions","modules/clean/react/browse/store","modules/clean/react/context_menu_v2"],function(e,t,r,s,n,o,i){var a,l,u,c,p,d,h;return d=s.getActionsForFileCollection,h=n.getGlobalActions,a=o.BrowseContext,c=i.GlobalContextMenu,u=i.ContextMenuItem,p=t.createElement,l=t.createClass({displayName:"BrowseContextMenu",propTypes:{context:t.PropTypes.instanceOf(a).isRequired,selectedFiles:t.PropTypes.instanceOf(e.OrderedSet).isRequired,shouldShowDeletedFiles:t.PropTypes.bool.isRequired,user:t.PropTypes.object.isRequired,onFileUpload:t.PropTypes.func},getDefaultProps:function(){return{onFileUpload:function(){}}},openMenuAtPosition:function(e,t){return this.refs.contextMenu.openMenuAtPosition(e,t)},closeMenu:function(){return this.refs.contextMenu.closeMenu()},toggleMenu:function(e){return this.refs.contextMenu.toggleMenu(e)},render:function(){var e,t,s,n,o,i,a,l,f,m;for(n=[],s=0===this.props.selectedFiles.size?h({context:this.props.context,user:this.props.user,showDeletedFiles:this.props.shouldShowDeletedFiles,onFileUpload:this.props.onFileUpload}):d({files:this.props.selectedFiles,context:this.props.context,user:this.props.user}),e=function(e){return u({text:e.label,icon:{group:"web",name:e.spriteName},onClick:e.performAction,href:e.href,isDisabled:e.disabled})},o=0,a=s.length;a>o;o++)t=s[o],l=e(t),(null!=(f=t.subItems)?f.length:void 0)&&(m=r.map(t.subItems,e),l=l.set("subMenuItems",m)),n.push(l);return i=["a:not(.filename-link)","input","button","textarea","select","#notify-wrapper",".db-modal-wrapper",".react-file-viewer"],p(c,{alwaysOpenOnCapture:!0,ignoreSelectors:i.join(),items:n,ref:"contextMenu"},this.props.children)}}),{BrowseContextMenu:l}})}.call(this),function(){define("modules/dirty/react/browse/file_list",["jquery","external/immutable","external/keymaster","external/react","external/underscore","modules/clean/filepath","modules/clean/keycode","modules/clean/components/loading_indicator","modules/clean/react/browse/columnheader","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/css","modules/clean/react/image","modules/clean/react/file_modal_controller","modules/clean/react/file_uploader/actions","modules/clean/react/outside_event","modules/clean/react/selectable_list","modules/clean/react/sprite","modules/clean/search/actions","modules/clean/static_urls","modules/clean/undo","modules/clean/viewer","modules/core/browser","modules/core/i18n","modules/core/notify","modules/dirty/react/browse/actions","modules/dirty/react/browse/file_list_row","modules/dirty/react/browse/folder_list_row"],function(e,t,r,s,n,o,i,a,l,u,c,p,d,h,f,m,_,g,y,S,b,v,w,F,T,D,P,R,C){var E,I,M,N,A,x,O,L,k,q,B,U,H,V,G,W,Q,j,K,z,Y,X,J,Z,$,ee,te,re,se;return N=l.ColumnHeader,A=l.ColumnTypes,x=u.Direction,I=u.BrowseSortField,O=u.DropTargetHighlightMode,H=u.FileTypes,G=u.LoadingStates,W=u.NameSpaceAccess,Q=u.NewFolderCreationState,L=c.File,E=c.BrowseContext,U=c.FileRename,M=p.BrowseStore,B=f.FileModalController,K=m.UploaderActions,Y=_.addOutsideEventHandling,J=g.createSelectableList,Z=g.createSelection,re=b.static_url,z=T._,ee=s.DOM,$=s.addons.classSet,X=s.createElement,V="FileList",j="",k=J(s.createClass({displayName:"FileList",mixins:[s.addons.PureRenderMixin],propTypes:{user:s.PropTypes.object.isRequired,context:s.PropTypes.instanceOf(E).isRequired,path:s.PropTypes.string,selectedFiles:s.PropTypes.instanceOf(t.OrderedSet),isSharedWithColumnVisible:s.PropTypes.bool,isKindColumnVisible:s.PropTypes.bool,isExtensionColumnVisible:s.PropTypes.bool,isSizeColumnVisible:s.PropTypes.bool,isShortcutsMenuVisible:s.PropTypes.bool,isRenaming:s.PropTypes.bool,openContextMenuAtPosition:s.PropTypes.func},getDefaultProps:function(){return{selectedFiles:t.OrderedSet(),isDraggingExternalFiles:!1,activeDropTarget:!1,isRenaming:!1}},componentWillMount:function(){return this.isFocused=!1},componentDidMount:function(){return e(document).on("keydown.FileList",this.handleKeyDown).on("keyup.FileList",this.handleKeyUp).on("mouseup.FileList",this.handleDocumentMouseUp),e(this.getDOMNode()).on("focusin.FileList",this.getFocusHandler(!0)).on("focusout.FileList",this.getFocusHandler(!1)),this._setupExternalDragHandler(),this._setupKeyboardShortcuts()},componentWillUnmount:function(){return key.clearScope(V),key.setScope(j),e(document).off(".FileList"),e(this.getDOMNode()).off(".FileList")},_setupExternalDragHandler:function(){return e(document).on("dragenter.FileList",function(t){return function(r){return t.props.isDraggingExternalFiles&&!e(r.target).closest(".browse-file-row").length&&t.props.activeDropTarget?(P.setDropTarget({target:null}),K.setPath({path:M.path(),hasPermissionToUploadToFolder:t.props.context.isCurrentPathWriteable()})):void 0}}(this))},_setupKeyboardShortcuts:function(){var t,r,s,n,o,i,a,l,u,c,p,d,h,f,m,_;return j=key.getScope(),key.setScope(V),i=function(e){return function(t){return e.isFocused&&"BUTTON"!==t.target.tagName}}(this),a=function(e){return function(){return document.activeElement===document.body||e.getDOMNode().contains(document.activeElement)}}(this),o=function(e,t){return function(r){return e(r)?(r.preventDefault(),t(r)):null}},c=function(e){return function(){return 1===e.props.selectedFiles.size&&e.props.selectedFiles.first().is_dir?P.navigateToSelectedFileOrFolder():void 0}}(this),u=function(e){return function(){return 1===e.props.selectedFiles.size?P.navigateToSelectedFileOrFolder():void 0}}(this),d=function(e){return function(){return 1===e.props.selectedFiles.size?e.props.context.isCurrentPathWriteable()?P.showFileRename({file:e.props.selectedFiles.first()}):D.warning(z("You don’t have permission to rename files in this folder.")):void 0}}(this),t=function(){return P.copySelectedFilesToClipboard()},p=function(){return P.pasteClipboardFilesToCurrentPath()},r=function(e){return function(){var t;return e.props.context.isCurrentPathWriteable()?(t=e.props.selectedFiles.toArray(),B.showDelete(e.props.user,t,e.props.context,function(){return P.selectRowsFromNotServer(t)})):D.warning(z("You don’t have permission to delete files in this folder."))}}(this),_=function(){return v.perform_undo()},f=function(e){return function(){return e.props.isShortcutsMenuVisible?void 0:(P.toggleShortcutsMenu(),key.setScope("KeyboardShortcutsMenu"))}}(this),n=function(e){return function(){return e.props.isShortcutsMenuVisible?(P.toggleShortcutsMenu(),key.setScope(V)):void 0}}(this),m=function(){return P.stopInternalDrag()},l=function(){return P.navigateToParentFolder()},h=function(t){return function(r){var s,n,o,i;return t.props.selectedFiles.size&&(i=e(r.target).closest(".browse-file-row--is-selected").first(),i.length)?(n=i[0].offsetLeft+200,o=i[0].offsetTop+5,"function"==typeof(s=t.props).openContextMenuAtPosition?s.openContextMenuAtPosition(n,o):void 0):void 0}}(this),s=function(){return e(".search-bar__text-input").focus()},key("right",V,o(i,c)),key("enter",V,o(i,u)),key("f2",V,o(i,d)),key("left",V,o(a,l)),key("/",V,o(a,s)),key("alt+a",V,o(a,h)),key("shift+/",V,o(a,f)),key("escape","KeyboardShortcutsMenu",n),key("escape",V,o(a,m)),F.mac?(key("command+c",V,o(i,t)),key("backspace",V,o(i,r)),key("command+v",V,o(a,p)),key("command+z",V,o(a,_))):(key("ctrl+c",V,o(i,t)),key("delete",V,o(i,r)),key("ctrl+v",V,o(a,p)),key("ctrl+z",V,o(a,_)))},handleKeyDown:function(e){var t,r;return t=null!=(r=e.which)?r:e.keyCode,t===i.CONTROL||t===i.ALT?P.setCopyMode({copyMode:!0}):void 0},handleKeyUp:function(e){var t,r;return t=null!=(r=e.which)?r:e.keyCode,t===i.CONTROL||t===i.ALT?P.setCopyMode({copyMode:!1}):void 0},handleDocumentMouseUp:function(e){var t;return M.isDraggingInternalFiles()&&(t=M.selectedFiles(),e.ctrlKey||e.altKey)?(P.stopInternalDrag(),P.copyFiles({files:t.toArray(),newPath:M.path()})):void 0},getFocusHandler:function(e){return function(t){return function(){return t.isFocused=e,!0}}(this)},render:function(){var e;return e={"browse-files o-list-ui":!0,"browse-files--single-selection":1===this.props.selectedFiles.size,"is-sharedwith-column-visible":this.props.isSharedWithColumnVisible,"is-kind-column-visible":this.props.isKindColumnVisible,"is-extension-column-visible":this.props.isExtensionColumnVisible,"is-size-column-visible":this.props.isSizeColumnVisible},ee.ul({className:$(e),role:"presentation",onMouseMove:this.handleMouseMove},this.props.children)}})),q=s.createClass({displayName:"FileListController",mixins:[s.addons.PureRenderMixin],propTypes:{context:s.PropTypes.instanceOf(E).isRequired,files:s.PropTypes.instanceOf(t.List).isRequired,user:s.PropTypes.object.isRequired,selectedFiles:s.PropTypes.instanceOf(t.OrderedSet),createNewFolderState:s.PropTypes.oneOf(n.values(Q)),customEmptyFolderView:s.PropTypes.func,dropTargetHighlightMode:s.PropTypes.oneOf(function(){var e;e=[];for(te in O)se=O[te],e.push(se);return e}()),fileRename:U.propTypes,isColumnHeaderVisible:s.PropTypes.bool,isModifiedColumnVisible:s.PropTypes.bool,isMultiColumnGroupVisible:s.PropTypes.bool,isShortcutsMenuVisible:s.PropTypes.bool,isTextSelectable:s.PropTypes.bool,loadingState:s.PropTypes.oneOf(n.values(G)),mostRecentlyDraggedOverFile:s.PropTypes.instanceOf(L),openContextMenuAtPosition:s.PropTypes.func,isDragAndDropEnabled:s.PropTypes.bool,isDraggingInternalFiles:s.PropTypes.bool,isDraggingExternalFiles:s.PropTypes.bool,activeDropTarget:s.PropTypes.object,selection:s.PropTypes.object,onSelectionChange:s.PropTypes.func,showFilenameHighlights:s.PropTypes.bool},getDefaultProps:function(){return{selectedFiles:t.OrderedSet(),createNewFolderState:Q.CREATE_FOLDER_INACTIVE,customEmptyFolderView:null,dropTargetHighlightMode:O.NONE,fileRename:null,isColumnHeaderVisible:!0,isMultiColumnGroupVisible:!0,isPaginating:!1,isShortcutsMenuVisible:!1,isTextSelectable:!0,mostRecentlyDraggedOverFile:null,isDragAndDropEnabled:!0,shouldHighlightDropTargets:!1,shouldHighlightNonselectedDropTargets:!1,showFilenameHighlights:!1}},getInitialState:function(){return{activeMultiColumn:0}},getSharedWithTitle:function(){return z(this.props.context.isInsideTeamFolder||this.props.context.isInsideSharedFolder?"Additional sharing":"Shared with")},_getColumns:function(){return[{type:A.STATIC,label:z("Row selection"),headerClassName:"ax-visually-hidden"},{type:A.SINGLE,label:z("Name"),headerClassName:"o-grid__col o-grid__col--6-of-12 u-pad-vertical-xs",sortCallback:function(e){return P.sortFiles({sortField:I.FILENAME,direction:e})}},{type:A.SINGLE,label:z("Modified"),headerClassName:"o-grid__col o-grid__col--3-of-12 u-pad-vertical-xs",sortCallback:function(e){return P.sortFiles({sortField:I.MODIFIED,direction:e})}},{type:A.MULTI,switchColumnCallback:function(e){return function(t){return e.setState({activeMultiColumn:t})}}(this),columns:[{label:this.getSharedWithTitle(),headerClassName:"o-grid__col o-grid__col--3-of-12 u-pad-vertical-xs",sortCallback:function(e){return P.sortFiles({sortField:I.FILENAME,direction:e})}},{label:z("Kind"),headerClassName:"o-grid__col o-grid__col--3-of-12 u-pad-vertical-xs",sortCallback:function(e){return P.sortFiles({sortField:I.KIND,direction:e})}},{label:z("Extension"),headerClassName:"o-grid__col o-grid__col--3-of-12 u-pad-vertical-xs",sortCallback:function(e){return P.sortFiles({sortField:I.EXTENSION,direction:e})}},{label:z("Size"),headerClassName:"o-grid__col o-grid__col--3-of-12 u-pad-vertical-xs",sortCallback:function(e){return P.sortFiles({sortField:I.SIZE,direction:e})}}]},{type:A.STATIC,label:z("Actions"),headerClassName:"ax-visually-hidden"}]},_shouldFileBeHighlightedDropTarget:function(e){var t,r,s;switch(t=e.file,r=e.isSelected,this.props.dropTargetHighlightMode){case O.ALL_FOLDERS:return t.is_dir&&!t.is_read_only_mount&&!t.isDeleted();case O.NONSELECTED_FOLDERS:return t.is_dir&&!t.is_read_only_mount&&!t.isDeleted()&&!r;case O.NONSELECTED_NONSHARED_FOLDERS:return t.is_dir&&!t.is_read_only_mount&&!t.isDeleted()&&!r&&t.type!==H.SHARED_FOLDER;case O.NONSELECTED_NONSHARED_NONTEAM_FOLDERS:return t.is_dir&&!t.is_read_only_mount&&!t.isDeleted()&&!r&&(s=t.type)!==H.SHARED_FOLDER&&s!==H.TEAM_SHARED_FOLDER;default:return!1}},renderFileRow:function(e,t){var r,s;return r=this._shouldFileBeHighlightedDropTarget({file:e,isSelected:this.props.selection.selected.has(e.fq_path)}),X(R,{key:e.fq_path,file:e,user:this.props.user,shouldFocus:this.props.selection.selected.last()===e.fq_path||!this.props.selection.selected.size&&0===t,isDragAndDropEnabled:this.props.isDragAndDropEnabled,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isAvailableDropTarget:r,isActiveDropTarget:e===this.props.activeDropTarget,isModifiedColumnVisible:this.props.isModifiedColumnVisible,isMultiColumnGroupVisible:this.props.isMultiColumnGroupVisible,isTextSelectable:this.props.isTextSelectable,context:this.props.context,renameState:(null!=(s=this.props.fileRename)?s.file:void 0)===e?this.props.fileRename.state:void 0,showColumnDetail:!this.props.isColumnHeaderVisible,showFilenameHighlights:this.props.showFilenameHighlights})},_renderLoadingIndicator:function(){return ee.div({className:"u-font-center u-pad-top-m"},X(a,{style:a.LoadingIndicatorStyle.BLUE_SPINNER}))},_renderEmptyFolderView:function(){var e,t,r,s,n,o,i;return n=this.props.context.isInsideSharedFolder&&this.props.context.currentSharedFolderPermissionRole===W.ACCESS_READER,o=this.props.context.isInsideTeamFolder,t={"u-l-dn":n,"drag-prompt":!0},o?(r=re("/static/images/empty_states/team-folder-vfl9QKFPe.png"),s=re("/static/images/empty_states/team-folder@2x-vfl8WLJuK.png"),i=z("This team folder is empty."),e=ee.div({},z("Everyone at %(team_name)s will automatically have access to anything you put here.").format({team_name:w.get_viewer().team_name}))):(r=re("/static/images/empty_states/files-vflsVPyeo.png"),s=re("/static/images/empty_states/files@2x-vflvkuH8g.png"),i=z("This folder is empty."),e=ee.div({},z("Drag and drop files onto this window to upload."))),ee.div({className:"u-font-center u-pad-top-xl"},X(h,{src:r,srcHiRes:s,alt:""}),ee.h2({},i),ee.div({className:$(t)},e))},_renderFileList:function(e){var t,r;return[function(){var s,n,o;for(o=[],r=s=0,n=e.length;n>s;r=++s)t=e[r],o.push(this.renderFileRow(t,r));return o}.call(this),this.props.loadingState===G.LOADING_REMAINING_PAGES?this._renderLoadingIndicator():void 0]},render:function(){var e,t,r,s;return t={"browse-file-list-header o-grid o-grid--no-gutter":!0,"ax-visually-hidden":this.props.selection.selected.size},r=this.props.files.toArray(),s=this.props.createNewFolderState!==Q.CREATE_FOLDER_INACTIVE,ee.div({role:"grid","aria-readonly":"true"},this.props.isColumnHeaderVisible?X(N,{columns:this._getColumns(),className:$(t),tabbable:!this.props.selection.selected.size,disabled:this.props.loadingState!==G.LOADED}):void 0,X(k,{user:this.props.user,context:this.props.context,selectedFiles:this.props.selectedFiles,isSharedWithColumnVisible:0===this.state.activeMultiColumn,isKindColumnVisible:1===this.state.activeMultiColumn,isExtensionColumnVisible:2===this.state.activeMultiColumn,isSizeColumnVisible:3===this.state.activeMultiColumn,isShortcutsMenuVisible:this.props.isShortcutsMenuVisible,isRenaming:!!this.props.fileRename,openContextMenuAtPosition:this.props.openContextMenuAtPosition,isDraggingExternalFiles:this.props.isDraggingExternalFiles,activeDropTarget:this.props.activeDropTarget,keyScope:V,linkedOutsideClasses:[".bubble-menu-item-wrapper",".browse-menu",".context-menu",".react-file-viewer"],selection:this.props.selection,onSelectionChange:this.props.onSelectionChange},s?X(C,{newFolderState:this.props.createNewFolderState,context:this.props.context}):void 0,this.props.loadingState===G.LOADING_FIRST_PAGE?this._renderLoadingIndicator():0!==r.length||s?this._renderFileList(r):("function"==typeof(e=this.props).customEmptyFolderView?e.customEmptyFolderView():void 0)||this._renderEmptyFolderView()))}}),{FileListController:d(q,["/static/css/scooter/scooter-scoped-vfl_Zq9la.css","/static/css/components/loading_indicator-vflbadB1S.css","/static/css/browse/browse-vflyaF8OY.css"]),FileList:k}})}.call(this),function(){define("modules/dirty/react/browse/file_list_row",["jquery","external/underscore","external/classnames","external/immutable","external/react","modules/clean/browse_interface","modules/clean/css","modules/clean/filepath","modules/clean/react/browse/constants","modules/clean/react/browse/name_input","modules/clean/react/browse/store","modules/clean/react/browse/render_partials","modules/clean/react/file_uploader/actions","modules/clean/react/react_i18n","modules/clean/react/sprite","modules/clean/search/search_helpers","modules/core/browser","modules/core/i18n","modules/dirty/react/browse/actions","modules/dirty/react/browse/share_button","modules/dirty/react/browse/shared_with","modules/clean/react/flag"],function(e,t,r,s,n,o,i,a,l,u,c,p,d,h,f,m,_,g,y,S,b,v){var w,F,T,D,P,R,C,E,I,M,N,A,x,O,L,k,q;return O=o.browse_uri_for_fq_path,q=o.get_browse_root_name,I=l.RenameStates,C=l.MouseEventButton,R=l.FileTypes,F=c.BrowseStore,T=c.File,w=c.BrowseContext,D=p.FileIcon,A=d.UploaderActions,E=h.R_,x=g._,M=S.ShareButton,N=b.SharedWithController,k=n.DOM,L=n.createElement,P=n.createClass({displayName:"FileListRow",mixins:[n.addons.PureRenderMixin],propTypes:{context:n.PropTypes.instanceOf(w).isRequired,file:n.PropTypes.instanceOf(T).isRequired,user:n.PropTypes.object,columnClasses:n.PropTypes.string,shouldFocus:n.PropTypes.bool,isSelected:n.PropTypes.bool,isDragAndDropEnabled:n.PropTypes.bool,isDraggingInternalFiles:n.PropTypes.bool,isDraggingExternalFiles:n.PropTypes.bool,isAvailableDropTarget:n.PropTypes.bool,isActiveDropTarget:n.PropTypes.bool,isTextSelectable:n.PropTypes.bool,isMultiColumnGroupVisible:n.PropTypes.bool,renameState:n.PropTypes.oneOf(t.values(I)),showColumnDetail:n.PropTypes.bool,showFilenameHighlights:n.PropTypes.bool,onMouseEnter:n.PropTypes.func,onMouseDown:n.PropTypes.func,onMouseUp:n.PropTypes.func},getDefaultProps:function(){return{columnClasses:"browse-file-row__column o-grid__col o-grid__col--am",isSelected:!1,shouldFocus:!1,isDragAndDropEnabled:!0,isAvailableDropTarget:!1,isActiveDropTarget:!1,isTextSelectable:!0,renameState:null,isMultiColumnGroupVisible:!0,showColumnDetail:!1,showFilenameHighlights:!1,onMouseEnter:function(){},onMouseDown:function(){},onMouseUp:function(){}}},getInitialState:function(){return{hasThumbErrored:!1}},componentDidMount:function(){return i.require_css("/static/css/scooter/scooter-scoped-vfl_Zq9la.css"),this.focusIfSelected(),e(this.getDOMNode()).on("dragenter.FileRow",function(e){return function(){if(e.props.isDraggingExternalFiles){if(e.props.file.is_dir){if(e.props.isActiveDropTarget)return;return y.setDropTarget({target:e.props.file}),A.setPath({path:e.props.file.fq_path,hasPermissionToUploadToFolder:!e.props.file.is_read_only_mount&&e.props.context.isCurrentPathWriteable()})}return y.setDropTarget({target:null}),A.setPath({path:F.path(),hasPermissionToUploadToFolder:e.props.context.isCurrentPathWriteable()})}}}(this)).on("focusin.fileRow",function(e){return function(){return e.state.focusedIn?void 0:e.setState({focusedIn:!0})}}(this)).on("focusout.fileRow",function(e){return function(){return e.setState({focusedIn:!1})}}(this)).on("mouseup.fileRow",this.handleMouseUp)},componentDidUpdate:function(e){var t,r,s;return s=this.props.isSelected!==e.isSelected,t=this.props.shouldFocus!==e.shouldFocus,r=this.props.renameState!==e.renameState,s||t||r?this.focusIfSelected():void 0},componentWillUnmount:function(){return e(this.getDOMNode()).off(".fileRow")},focusIfSelected:function(){return this.props.isSelected&&this.props.shouldFocus&&!this.props.renameState?this.getDOMNode().focus():void 0},handleMouseEnter:function(e){return this.props.isDraggingInternalFiles||this.props.isDraggingExternalFiles?void y.setDropTarget({target:this.props.file}):this.props.onMouseEnter(e)},handleMouseLeave:function(){return this.props.isDraggingInternalFiles||this.props.isDraggingExternalFiles?y.setDropTarget({target:null}):void 0},handleMouseDown:function(e){return this.props.onMouseDown(e)},handleMouseUp:function(e){var t;return this.props.isAvailableDropTarget?(t=e.ctrlKey||e.altKey,y.dropInternalFiles({target:this.props.file,isCopying:t}),e.stopPropagation()):y.stopInternalDrag(),this.props.onMouseUp(e)},handleMouseMove:function(e){var t;t=1===e.buttons,t&&this.props.isDragAndDropEnabled&&this.props.isSelected&&y.startInternalDrag()},handleFilenameClick:function(e){return this.props.isTextSelectable?void 0:(e.preventDefault(),e.stopPropagation(),y.navigateToFileOrFolder({file:this.props.file}))},handleRenameSubmit:function(e){return y.renameFile({file:this.props.file,newName:e})},handleRenameCancel:function(){return y.cancelFileRename({file:this.props.file})},_renderSelectionToggleColumn:function(){return k.div({className:"ax-visually-hidden",role:"gridcell"},k.input({type:"checkbox","aria-label":x("Select row"),tabIndex:-1,checked:this.props.isSelected,onChange:function(e){return function(){return y.toggleFqPathSelected({path:e.file.fq_path})}}(this)}))},_renderPlaceholder:function(){return k.span({"aria-hidden":"true"},"--")},_renderHiddenText:function(){var e;return e=[],this.props.file.isDeleted()&&e.push(x("Deleted")),this.props.isSelected&&e.push(x("Selected")),this.props.file.is_dir&&e.push(x(this.props.file.type===R.SHARED_FOLDER?this.props.file.is_read_only_mount?"Read-only shared folder":"Shared folder":this.props.file.type===R.TEAM_SHARED_FOLDER?this.props.file.is_read_only_mount?"Read-only team shared folder":"Team shared folder":"Folder")),e.length>0?k.span({className:"ax-visually-hidden"}," "+e.join(" ")):void 0},_renderFilename:function(){var e,r,s,n,o,i,l;return e=this.props.file,r=a.filename(e.fq_path),s=this.props.showFilenameHighlights?m.highlightMatchString(r,e.filename_highlights):t.escape(r),o=a.parent_dir(e.fq_path),i=O(this.props.user,o),l="/"===o?q(this.props.user):o,this.props.renameState===I.PENDING_INPUT?(n=x(e.is_dir?"Rename directory…":"Rename file…"),L(u,{ref:"nameInput",label:n,defaultValue:a.filename(e.fq_path),onSubmit:this.handleRenameSubmit,onCancel:this.handleRenameCancel,className:"browse-file-row__input"})):this.props.renameState===I.SAVING_INPUT?k.span({ref:"renameStatus",role:"status"},x("Renaming…")):k.div({className:"browse-file-row__name-location"},k.a({ref:"filenameLink",className:"filename-link u-ellip browse-file-row__name",href:e.href,onClick:this.handleFilenameClick,onDragStart:function(e){return function(t){return t.preventDefault(),e.props.isSelected||y.setSelectedFiles({files:[e.props.file]}),y.startInternalFileDrag()}}(this)},k.span({dangerouslySetInnerHTML:{__html:s}}),this._renderHiddenText()),this.props.showColumnDetail?k.a({className:"u-ellip browse-file-row__location",href:i,onClick:function(e){return y.setUrl({path:o}),e.preventDefault()}},E({comment:"Describes the parent directory of a file in a list of search results.",location:l},"in <span class='browse-file-row__location-link'>%(location)s</span>")):void 0)},_renderFilenameColumn:function(){var e,t;return e=L(D,{className:"u-pad-right-xs",ref:"icon",file:this.props.file,onClick:this.handleFilenameClick,onDragStart:function(e){return function(t){return t.preventDefault(),e.props.isSelected||y.setSelectedFiles({files:[e.props.file]}),y.startInternalFileDrag()}}(this)}),t=this._renderFilename(),k.div({ref:"filenameColumn",className:r(""+this.props.columnClasses,"column--filename","u-ellip","o-grid__col--6-of-12"),role:"gridcell"},L(v,{leftAttachment:e},t))},_renderModifiedColumn:function(){var e,t,s;return e=this.props.file.last_modified_fname||"",t=this.props.file.ago||this._renderPlaceholder(),this.props.showColumnDetail&&(t=this.props.file.ago?x("Modified %(ago)s").format({ago:this.props.file.ago}):""),k.div({className:r((s={},s[""+this.props.columnClasses]=!0,s["u-ellip"]=!0,s["o-grid__col--3-of-12"]=this.props.isMultiColumnGroupVisible,s["o-grid__col--6-of-12"]=!this.props.isMultiColumnGroupVisible,s)),role:"gridcell"},t,e.length?k.span({className:"browse-file-row__modifier u-font-meta"},e):void 0)},_renderMultiColumnGroup:function(){var e;return e=function(e){return function(t,r){return k.div({className:"column--multi "+e.props.columnClasses+" column--"+t+" o-grid__col--3-of-12",role:"gridcell",key:t},r)}}(this),[e("sharedwith",L(N,{file:this.props.file,browseContext:this.props.context})),e("kind",this.props.file.getKind()),e("extension",this.props.file.getExtension()||this._renderPlaceholder()),e("size",this.props.file.size||this._renderPlaceholder())]},_renderActionsColumn:function(){return k.div({className:"sharing__actions",role:"gridcell"},this.props.user&&!this.props.file.isDeleted()?L(M,{ref:"shareButton",browseContext:this.props.context,file:this.props.file,user:this.props.user}):void 0)},render:function(){var e,t;return e={"browse-file-row":!0,"browse-file-row--focused-in":this.state.focusedIn,"browse-file-row--is-selected":this.props.isSelected,"browse-file-row--is-deleted":this.props.file.isDeleted(),"browse-file-row--is-drop-target":this.props.isAvailableDropTarget,"browse-file-row--file-dragged-over":this.props.isAvailableDropTarget&&this.props.isActiveDropTarget,"o-grid":!0,"o-grid--no-gutter":!0},k.li({className:r(e),"data-filename":this.props.file.fq_path.split("/").slice(-1),role:"row",tabIndex:"-1",onContextMenuCapture:this.handleContextMenu,onMouseEnter:this.handleMouseEnter,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onClick:this.props.onClick,onDoubleClick:this.handleFilenameClick},this._renderSelectionToggleColumn(),this._renderFilenameColumn(),this._renderModifiedColumn(),this.props.isMultiColumnGroupVisible?function(){var e,r,s,n;for(s=this._renderMultiColumnGroup(),n=[],e=0,r=s.length;r>e;e++)t=s[e],n.push(t);return n}.call(this):void 0,this._renderActionsColumn())}})})}.call(this),function(){define("modules/dirty/react/browse/folder_list_row",["jquery","external/classnames","external/immutable","external/react","external/underscore","modules/clean/filepath","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/sprite","modules/core/i18n","modules/dirty/react/browse/actions","modules/clean/static_urls","modules/clean/react/browse/name_input","modules/clean/react/flag"],function(e,t,r,s,n,o,i,a,l,u,c,p,d,h){var f,m,_,g,y,S,b;return _=i.NewFolderCreationState,f=a.BrowseContext,g=u._,b=p.static_url,S=s.DOM,y=s.createElement,m=s.createClass({displayName:"NewFolderCreationListRow",mixins:[s.addons.PureRenderMixin],propTypes:{newFolderState:s.PropTypes.oneOf(n.values(_)),context:s.PropTypes.instanceOf(f)},componentDidMount:function(){return this._unselectOtherFiles()},_handleBlur:function(e){return c.createFolder({folderName:e.currentTarget.value})},_handleCancel:function(){return c.cancelCreateFolder()},_handleSubmit:function(e){return c.createFolder({pathName:this.props.context.currentFQPath,folderName:e})},_unselectOtherFiles:function(){return c.setSelectedFiles({files:[]})},_renderIcon:function(){return y(l,{group:"web",name:b("/static/images/icons/icon_spacer-vflN3BYt2.gif"),className:"u-pad-right-xs sprite sprite_web s_web_folder_32 browse-file-row__accessory",alt:""})},_renderNewFolderCreationColumn:function(){var e,t;return e=this._renderIcon(),t=S.div({}),this.props.newFolderState===_.PENDING_INPUT?t=y(d,{defaultValue:"",label:g("Folder name"),onSubmit:this._handleSubmit,onCancel:this._handleCancel,className:"browse-file-row__input"}):this.props.newFolderState===_.SAVING_INPUT&&(t=S.div({className:"creating_folder_text",role:"status","aria-live":"polite"},g("Creating new folder…"))),S.div({className:"o-grid__col--1-of-2",role:"gridcell"},y(h,{leftAttachment:e},t))},_renderPlaceholder:function(){return S.div({role:"gridcell"})},render:function(){var e;return e={"browse-file-row":!0,"o-grid":!0,"o-grid--no-gutter":!0,"browse-file-row--is-selected":!0},S.li({className:t(e),role:"row"},this._renderPlaceholder(),this._renderNewFolderCreationColumn(),this._renderPlaceholder(),this._renderPlaceholder(),this._renderPlaceholder())}})})}.call(this),function(){define("modules/dirty/react/browse/global_actions",["external/react","modules/clean/components/title_bubble","modules/clean/css","modules/clean/filepath","modules/dirty/react/browse/actions","modules/dirty/sharing/browse_ui_util","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/store","modules/clean/react/button","modules/clean/react/sprite","modules/clean/sharing/ui_util","modules/clean/user","modules/core/i18n"],function(e,t,r,s,n,o,i,a,l,u,c,p,d,h){var f,m,_,g,y,S,b,v,w,F;return F=o.showTiburonUIIfAllowed,_=a.NameSpaceAccess,f=l.BrowseContext,S=u.button,g=p.Tiburon,y=h._,v=e.DOM,b=e.createElement,w=function(){return function(e){var t,r,o,a,l,u,c,p,d,h,f,m,S,b,v;return t=e.context,v=e.user,b=e.showDeletedFiles,m=e.onFileUpload,h="/"===t.currentFQPath,d=t.isInsideSharedFolder&&t.currentSharedFolderPermissionRole===_.ACCESS_READER,S=y(t.isInsideTeamFolder?"Team folder options…":t.isInsideSharedFolder?"Shared folder options…":h?"Share a folder…":"Share this folder…"),r=function(e){return e.preventDefault(),m(e)},o=function(e){return e.preventDefault(),n.nameNewFolder()},c=function(e){return e.preventDefault(),F(v,t)?void 0:require(["dropbox"],function(e){var r;return r=e.SharingModals,t.isInsideSharedFolder?r.show_shared_folder_options_modal(t.currentFQPath,v):h?r.show_shared_folder_wizard(v):r.show_share_existing_modal(t.currentFQPath,v)})},u=function(e){return e.preventDefault(),F(v,t)?void 0:require(["dropbox"],function(e){var r,s;return s=e.SharingShmodel,r=e.Browse,null==r.active_user&&(r.active_user=v),s.shmodel(t.currentFQPath,"global_actions_basic_global_token_share")})},p=function(e){return e.preventDefault(),n.setShouldShowDeletedFiles({shouldShowDeletedFiles:!b})},l=function(e){return e.preventDefault(),i.redirectToFolderRestore({fqPath:t.currentFQPath,userId:v.id})},a=function(e){var r,n,o;return e.preventDefault(),n=t.currentFQPath.toLowerCase(),o=t.inactiveNSIDByFQPath[n],r=s.filename(t.currentFQPath),o?require(["dropbox"],function(e){var t;return t=e.SharingModals,t.show_rejoin_modal(v,r,o)}):void 0},f=[],t.isInsideDeletedSharedFolder?f.push({label:y("Rejoin shared folder…"),spriteName:"restore",performAction:a}):t.isInsideDeletedFolder||t.isInsideDeletedNestedSharedFolder?f.push({label:y("Restore folder"),spriteName:"restore",performAction:l}):(f.push({label:y("Upload…"),spriteName:"upload_16",performAction:r,disabled:d}),f.push({label:y("New folder"),spriteName:"folder_add",performAction:o,disabled:d}),f.push({label:S,spriteName:"rainbow_16",performAction:c}),h||g.foldersUI(v)||f.push({label:y("Share link…"),spriteName:"s_link",performAction:u}),f.push({label:y(b?"Hide deleted files":"Show deleted files"),spriteName:b?"trash-can-open":"trash-can",performAction:p})),f}}(this),m=e.createClass({displayName:"GlobalActions",propTypes:{shouldShowDeletedFiles:e.PropTypes.bool.isRequired,context:e.PropTypes.instanceOf(f).isRequired,user:e.PropTypes.instanceOf(d).isRequired,onFileUpload:e.PropTypes.func.isRequired,isActionsBarDisabled:e.PropTypes.bool.isRequired},_renderButton:function(e){var r,s,n,o,i,a;return n=e.message,a=e.spriteName,o=e.onClick,r=e.disabled,s=e.index,i=v.button({className:"global-actions__button sprite-button",
disabled:r,onClick:o},b(c,{className:"global-actions__button-sprite",group:"web",name:a,alt:n})),v.li({className:"global-actions__action",key:s},r?i:b(t,{text:n,direction:"south"},i))},render:function(){var e,t,r;return r=w({context:this.props.context,user:this.props.user,showDeletedFiles:this.props.shouldShowDeletedFiles,onFileUpload:this.props.onFileUpload}),v.div({className:"global-actions u-mar-top-xs"},v.ul({className:"horizontal"},function(){var s,n,o;for(o=[],e=s=0,n=r.length;n>s;e=++s)t=r[e],o.push(this._renderButton({message:t.label,spriteName:t.spriteName,onClick:t.performAction,disabled:t.disabled||this.props.isActionsBarDisabled,index:e}));return o}.call(this)))}}),{getGlobalActions:w,GlobalActions:m}})}.call(this),function(){define("modules/dirty/react/browse/preview_sf_members",["jquery","external/react","modules/clean/ajax","modules/clean/analytics","modules/clean/avatar/photo_avatar","modules/clean/avatar/size","modules/clean/react/browse/store","modules/clean/browse_events","modules/clean/css","modules/clean/components/loading_indicator","modules/clean/components/title_bubble","modules/clean/em_string","modules/clean/gandalf_util","modules/clean/react/button","modules/clean/viewer","modules/core/browser","modules/core/i18n","modules/clean/sharing/member_avatars","modules/clean/static_urls","modules/clean/filepath","modules/clean/sharing/api","modules/clean/sharing/ui_util","modules/dirty/sharing/browse_ui_util"],function(e,t,r,s,n,o,i,a,l,u,c,p,d,h,f,m,_,g,y,S,b,v,w){var F,T,D,P,R,C,E,I,M,N,A,x,O,L,k,q,B,U;return M=s.SharedFolderActivityLogger,D=o.AVATAR_DIMENSION_BY_SIZE,P=i.BrowseContext,O=_._,U=_.ungettext,B=y.static_url,N=b.SharingApi,x=v.Tiburon,q=w.showTiburonUIIfAllowed,L=t.createElement,k=t.DOM,C=15,T=D.MEDIUM,A="south",F=!0,E=t.createClass({displayName:"PreviewSFMembersPanel",propTypes:{context:t.PropTypes.instanceOf(P).isRequired,user:t.PropTypes.object.isRequired},getInitialState:function(){return{viewProps:{}}},componentDidMount:function(){return this._fetchSharedFolderMembers(),this._log_event("preview_sf_members_shown"),e(document).on(N.REQUEST_SUCCEEDED_EVENT,this._sharing_api_request_handler)},componentWillUnmount:function(){var t;return null!=(t=this._currentRequest)&&t.abort(),e(document).off(N.REQUEST_SUCCEEDED_EVENT,this._sharing_api_request_handler)},componentDidUpdate:function(e){var t,r;return(null!=(t=e.context)?t.currentFQPath:void 0)!==(null!=(r=this.props.context)?r.currentFQPath:void 0)?(this._fetchSharedFolderMembers(),this._log_event("preview_sf_members_shown")):void 0},_canShareAsNestedSharedFolder:function(){return this.props.context.currentNSPath&&this.props.context.currentNSAllowsNesting},_sharing_api_request_handler:function(e,t){var r;return r=t.request_url,r.indexOf("/share_ajax/leave")>-1||r.indexOf("/share_ajax/unshare")>-1||!this.props.context.isInFolderMode||t.ns_id!==this.props.context.currentNSID?void 0:this._fetchSharedFolderMembers()},_fetchSharedFolderMembers:function(){var e;return e="/share_ajax/preview_members/"+this.props.context.currentNSID,this._currentRequest=r.WebRequest({url:e,subject_user:this.props.user,data:{max_results:C},success:function(e){return function(t){var r;return t=JSON.parse(t),t.ns_id===e.props.context.currentNSID?(r={numUndisplayableUsersAndInvites:t.num_avatars_not_shown,numUsersAndInvites:t.num_users_and_invites,numUsersAndInvitesOutsideTeam:t.num_users_and_invites_outside_team,groups:t.groups,invitations:t.invitations,joinedMembers:t.joined_members},t.user_can_invite&&(e.props.context.isInsideSharedFolder&&!e.props.context.isInsideTeamFolder||e._canShareAsNestedSharedFolder())&&(r.inviteButton=new R({onClick:e.invite_button_click_handler})),e.setState({viewProps:r})):void 0}}(this),complete:function(e){return function(){return e._currentRequest=null}}(this)})},settings_button_click_handler:function(){return this._log_event("preview_sf_members_settings_button_clicked"),q(this.props.user,this.props.context)?void 0:this._show_shared_folder_members_modal()},invite_button_click_handler:function(){return this._log_event("preview_sf_members_invite_button_clicked"),this._show_add_people_modal()},avatar_click_handler:function(){return this._log_event("preview_sf_members_avatar_clicked"),q(this.props.user,this.props.context)},overflow_click_handler:function(){return this._log_event("preview_sf_members_overflow_number_clicked"),q(this.props.user,this.props.context)?void 0:this._show_shared_folder_members_modal()},focus_sharing_options_modal_invite_form:function(){return require(["dropbox","modules/clean/dbmodal"],function(t){return function(r,s){var n,o;return o=r.ExistingSharedFolderOptionsContent,n=s.DBModalStack,n.unregister(o.CONTENT_LOADED_EVENT,t.focus_sharing_options_modal_invite_form),e("#sharing-options-new-collab-input").focus()}}(this))},_show_shared_folder_members_modal:function(){return require(["dropbox"],function(e){return function(t){var r;return r=t.SharingModals,e._canShareAsNestedSharedFolder()?r.show_share_existing_modal(e.props.context.currentFQPath,e.props.user):r.show_shared_folder_options_modal(e.props.context.currentMountPoint,e.props.user,!e.props.context.config.isSimpleSharingEnabled)}}(this))},_show_add_people_modal:function(){return require(["dropbox","modules/clean/dbmodal"],function(e){return function(t,r){var s,n,o;return n=t.ExistingSharedFolderOptionsContent,o=t.SharingModals,s=r.DBModalStack,e._canShareAsNestedSharedFolder()?o.show_share_existing_modal(e.props.context.currentFQPath,e.props.user):e.props.context.config.isSimpleSharingEnabled?o.show_share_inband_modal(e.props.context.currentMountPoint,e.props.user,e.props.context.currentNSID,e.props.context.currentSharedFolderPermissionRole):(s.register(n.CONTENT_LOADED_EVENT,e.focus_sharing_options_modal_invite_form),o.show_shared_folder_options_modal(e.props.context.currentMountPoint,e.props.user))}}(this))},_log_event:function(e,t){return null==t&&(t={}),t.ns_id=this.props.context.currentNSID,M.log("web",e,this.props.user,t)},getNameOfTargetFolder:function(){var e;return e=this.props.context.currentMountPoint,!e||this._canShareAsNestedSharedFolder()?S.filename(this.props.context.currentFQPath):e.split("/").pop()},render:function(){var t,r;return t={folderName:this.getNameOfTargetFolder(),user:this.props.user,onSettingsButtonClick:this.settings_button_click_handler,onOverflowCountClick:this.overflow_click_handler,onAvatarClick:this.avatar_click_handler,folderType:this.props.context.isInsideTeamFolder?"TEAM":"SHARED"},r=e.extend(t,this.state.viewProps),k.div({className:"PreviewSFMembersPanel"},L(I,r))}}),I=t.createClass({displayName:"PreviewSFMembersView",mixins:[g],propTypes:{folderName:t.PropTypes.string.isRequired,folderType:t.PropTypes.oneOf(["SHARED","TEAM"]).isRequired,user:t.PropTypes.object.isRequired,onSettingsButtonClick:t.PropTypes.func.isRequired,onOverflowCountClick:t.PropTypes.func,onAvatarClick:t.PropTypes.func,inviteButton:t.PropTypes.element,numUndisplayableUsersAndInvites:t.PropTypes.number,numUsersAndInvites:t.PropTypes.number,numUsersAndInvitesOutsideTeam:t.PropTypes.number,groups:t.PropTypes.array,invitations:t.PropTypes.array,joinedMembers:t.PropTypes.array,avatarDimension:t.PropTypes.number,titleButtonDirection:t.PropTypes.string},getDefaultProps:function(){return{titleButtonDirection:A,avatarDimension:T,maxVisibleAvatars:C,animation:F}},componentDidMount:function(){return l.require_css("/static/css/avatar_list-vflRVLzmw.css"),l.require_css("/static/css/components/loading_indicator-vflbadB1S.css"),l.require_css("/static/css/preview_sf_members-vflrZUBX0.css"),l.require_css("/static/css/scooter/scooter-scoped-vfl_Zq9la.css")},render:function(){return k.div({className:this.getClassName()},this.renderButtons(),this.renderFolderInfo(),this.props.numUsersAndInvites?"SHARED"===this.props.folderType?this.renderAvatars():this.renderTeamFolder():k.div({className:"loading-indicator-container"},L(u)))},getClassName:function(){return t.addons.classSet({"preview-sf-members-box":!0,clearfix:!0,"team-folder":"TEAM"===this.props.folderType})},renderTeamFolder:function(){var e,t;return e=null,this.props.groups&&(t=this.props.groups[0],t&&t.is_automatic&&(e=O("editor"===t.access_type?"%(group_name)s can edit":"%(group_name)s can view"),e=e.format({group_name:t.name}))),e||(e=O("Shared with all members of %(team_name)s").format({team_name:f.get_viewer().team_name})),k.div({className:"team-folder-member-entry"},n({dimension:24,photoUrl:B("/static/images/icons/team_24-vflGwWtBj.png"),shape:"SQUARE",optionalClass:"u-l-fl"}),k.div({className:"team-folder-string"},e))},renderButtons:function(){return k.div({className:"buttons"},L(h.button,{className:"settings-button",importance:"tertiary",onClick:this.props.onSettingsButtonClick,title:O("Settings")},O(x.foldersUI(this.props.user)?"Share":"Settings")),x.foldersUI(this.props.user)?void 0:this.props.inviteButton)},renderFolderInfo:function(){return k.div({className:"shared-folder-info"},k.span({className:"shared-folder-name"},p.em_snippet(this.props.folderName,18)),this.props.numUsersAndInvites?k.span({className:"bullet"},"•"):void 0,this.props.numUsersAndInvites?this.renderNumberOfMembers():void 0)},renderNumberOfMembers:function(){var e,t;return t=U("%(num_total)s member","%(num_total)s members",this.props.numUsersAndInvites,{comment:'Another pluralized string MAY be concatenated to this to make a string like: "15 members (4 outside of TechCorp Inc.)"'}),this.props.numUsersAndInvitesOutsideTeam?(t+=U(" (%(num_outside)s outside of %(team_name)s)"," (%(num_outside)s outside of %(team_name)s)",this.props.numUsersAndInvitesOutsideTeam,{comment:'This will be concatenated to another string to make a string like: "15 members (4 outside of TechCorp Inc.)"'}),e=t.format({num_total:this.props.numUsersAndInvites,num_outside:this.props.numUsersAndInvitesOutsideTeam,team_name:p.em_snippet(f.get_viewer().team_name,16)})):e=t.format({num_total:this.props.numUsersAndInvites}),k.span({className:"members-string"},e)},renderAvatars:function(){var e,t,r,s,n;return e=[],n=[],this.props.numUsersAndInvites&&(s=this.findOwnerAndMeInJoinedMembers(this.props.joinedMembers),r=s[0],t=s[1],null!=r&&(e.push(this.renderJoinedMember(r)),n.push(r.user_id)),null!=t&&t!==r&&(e.push(this.renderJoinedMember(t)),n.push(t.user_id)),this.addGroupsMembersInvitations(e,this.props.groups,this.props.joinedMembers,this.props.invitations,n)),this.renderAvatarList(e)}}),R=t.createClass({displayName:"InviteButton",propTypes:{onClick:t.PropTypes.func.isRequired},render:function(){return h.button({className:"invite-button",importance:"tertiary",onClick:this.props.onClick,title:O("Add members"),"aria-label":O("Add members")})}}),{PreviewSFMembersPanel:E}})}.call(this),function(){define("modules/dirty/react/browse/selection_actions",["external/immutable","external/react","modules/clean/filepath","modules/clean/react/browse/store","modules/clean/react/browse/util","modules/clean/react/bubble_menu","modules/clean/react/sprite","modules/core/i18n","modules/dirty/react/browse/file_actions"],function(e,t,r,s,n,o,i,a,l){var u,c,p,d,h,f,m,_,g,y;return u=s.BrowseContext,g=n.describeFiles,p=o.BubbleMenu,d=o.BubbleMenuItem,h=a._,y=l.getActionsForFileCollection,_=t.DOM,m=t.addons.classSet,f=t.createElement,c=t.createClass({displayName:"BrowseSelectionMenu",mixins:[t.addons.PureRenderMixin],propTypes:{context:t.PropTypes.instanceOf(u).isRequired,selectedFiles:t.PropTypes.instanceOf(e.OrderedSet).isRequired,user:t.PropTypes.object.isRequired},componentDidUpdate:function(){var e;return null!=(e=this.refs.moreActionsBubbleMenu)?e.hideIfShown():void 0},_renderMenuButton:function(e){var t,r,s,n,o,a,l,u,c,p;return n=e.label,p=e.spriteName,a=e.performAction,s=e.href,l=e.ref,r=null!=(u=e.disabled)?u:!1,null!=a?(t={ref:l,className:"button-as-link browse-menu__action-button",onClick:function(e){return r?void 0:a(e)}},r&&(t.disabled=!0),c=_.button(t,f(i,{group:"web",name:p,alt:"",className:"browse-menu__action-button-sprite"}),_.span({className:"browse-menu__action-button-label"},n))):null!=s&&(c=_.a({ref:l,className:"browse-menu__action-button",href:s},f(i,{group:"web",name:p,alt:"",className:"browse-menu__action-button-sprite"}),_.span({className:"browse-menu__action-button-label"},n))),o={"browse-menu__action":!0,"browse-menu__action--disabled":r},_.li({key:n,className:m(o)},c)},_renderMoreActionsDropdown:function(e){var t,r;return r=_.button({className:"button-as-link browse-menu__action-button"},h("More")," ",f(i,{group:"web",name:"arrow-down-blue",alt:"",className:"browse-menu__more-dropdown-arrow"})),t=e.map(function(e){var t,r,s,n,o,a;return s=e.label,a=e.spriteName,n=e.performAction,r=e.href,t=null!=(o=e.disabled)?o:!1,f(d,{href:r,onClick:function(){return"function"==typeof n?n():void 0},disabled:t},f(i,{group:"web",name:a,alt:"",className:"browse-menu__action-button-sprite"}),_.span({className:"browse-menu__action-button-label"},s))}),_.li({className:"browse-menu__action"},f(p,{ref:"moreActionsBubbleMenu",targetButton:r,arrow_position:"top-right",items:t}))},render:function(){var e,t,r,s,n;return 0===this.props.selectedFiles.count()?_.div({className:"browse-menu browse-file-list-header"}):(e=g(this.props.selectedFiles),t=1!==this.props.selectedFiles.count()||this.props.selectedFiles.first().is_dir?"":this.props.selectedFiles.first().size,this.props.selectedFiles.isEmpty()?null:(s=y({files:this.props.selectedFiles,context:this.props.context,user:this.props.user,skipSharing:!0}),s.length>6&&(n=s.slice(5),s=s.slice(0,5)),_.div({className:"browse-menu browse-file-list-header"},_.span({className:"browse-menu__description"},e),_.ul({className:"browse-menu__actions"},function(){var e,t,n;for(n=[],e=0,t=s.length;t>e;e++)r=s[e],n.push(this._renderMenuButton(r));return n}.call(this),n?this._renderMoreActionsDropdown(n):void 0),_.span({className:"browse-menu__filesize-label"},t))))}}),{BrowseSelectionMenu:c}})}.call(this),function(){define("modules/dirty/react/browse/share_button",["require","external/classnames","external/react","modules/clean/css","modules/clean/keycode","modules/clean/react/button","modules/clean/react/browse/store","modules/clean/react/sprite","modules/clean/sharing/models/file","modules/clean/sharing/ui_util","modules/core/i18n","modules/dirty/react/browse/sharing_shims","modules/dirty/sharing/browse_ui_util"],function(e,t,r,s,n,o,i,a,l,u,c,p,d){var h,f,m,_,g,y,S,b,v,w,F,T,D;return y=o.button,h=i.BrowseContext,f=i.File,S=l.canConvertToSharedFolder,_=u.Tiburon,g=c._,F=p.initiateSharingFromUIElement,w=p.hasMultipleSharingOptions,D=d.showTiburonUIIfAllowed,T=d.isTiburonUIAllowed,v=r.DOM,b=r.createElement,m=r.createClass({displayName:"ShareButton",mixins:[r.addons.PureRenderMixin],propTypes:{browseContext:r.PropTypes.instanceOf(h).isRequired,file:r.PropTypes.instanceOf(f).isRequired,user:r.PropTypes.object.isRequired},handleClick:function(){var e,t,r,s,n;return r=this.props,n=r.user,t=r.file,e=r.browseContext,s=this.refs.button.getDOMNode(),F(s,n,t,e)},handleDoubleClick:function(e){return e.stopPropagation(),this.handleClick()},render:function(){var e,r;return r=w(this.props.user,this.props.file,this.props.browseContext),e={"c-btn c-btn--tertiary":!0,"inline-button":!0,"inline-share-button":!0,"variant-DROPDOWN":!0,"extra-padding":!r},b(y,{className:t(e),onClick:this.handleClick,onDoubleClick:this.handleDoubleClick,ref:"button",importance:"secondary"},v.span({className:"inline-share-button-label"},g("Share")),r?b(a,{group:"web",name:"arrow-down-blue",alt:""}):void 0)}}),{ShareButton:m}})}.call(this),function(){var e=function(e,r){function s(){this.constructor=e}for(var n in r)t.call(r,n)&&(e[n]=r[n]);return s.prototype=r.prototype,e.prototype=new s,e.__super__=r.prototype,e},t={}.hasOwnProperty,r=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/dirty/react/browse/shared_with",["jquery","external/react","external/underscore","modules/core/user_i18n","modules/clean/account/email","modules/clean/ajax","modules/clean/flux/base_store","modules/clean/flux/dispatcher","modules/clean/flux/store_mixin","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/sharing/shared_with_view","modules/clean/sharing/api","modules/clean/sharing/api/client","modules/clean/sharing/ui_util","modules/clean/file_events","modules/dirty/sharing/browse_ui_util"],function(t,s,n,o,i,a,l,u,c,p,d,h,f,m,_,g,y,S){var b,v,w,F,T,D,P,R,C,E,I,M,N,A,x,O,L,k,q,B,U;return F=i.EmailVerification,b=p.BrowseActionTypes,P=p.FileTypes,M=p.SharedWithActionTypes,v=d.BrowseContext,T=d.File,w=h.BrowseStore,L=f.SharedWithView,k=m.SharingApi,D=_.FileShareApiClient,U=S.showTiburonUIIfAllowed,B=s.DOM,q=s.createElement,E=5,R=100,I=100,C="file_row_sharing_menu",O=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype._init=function(){return this._sharedFolderDataByTargetNs={},this._sharedLinkDataMapsByFolderFQPath={},this._filesWeHaveSharedLinkDataFor={},this._sharedFileDataByFileId={}},r.prototype.hasLinkDataForFile=function(e){return e.fq_path in this._filesWeHaveSharedLinkDataFor},r.prototype.clearSharedLinkDataCache=function(){return this._filesWeHaveSharedLinkDataFor={}},r.prototype.getDataForFile=function(e){var t,r,s,n,o;return r=null,null!=e.target_ns&&(r=this._sharedFolderDataByTargetNs[e.target_ns]),this._canBeSharedFile(e)&&(r=this._sharedFileDataByFileId[null!=(s=e.file_id)?s:e.fq_path]),t=w.path(),o=this._sharedLinkDataMapsByFolderFQPath[t],o&&(n=o[this._sharedLinkKey(e)],n?(r||(r={}),r.sharedLinkInfo=n):null!=r&&delete r.sharedLinkInfo),r},r.prototype._sharedLinkKey=function(e){return e.fq_path+"_"+e.ns_id+"_"+e.sjid},r.prototype._new_payload=function(e){switch(e.action.type){case b.LOAD_PATH:return this._pathLoaded(e.action.data);case b.ADD_FILES:return this._filesAdded(e.action.data);case b.INITIALIZE_EVERYTHING:return this._browseInitializeEverything(e.action.data);case b.CHANGE_FILES:return this._filesChanged(e.action.data);case M.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE:return this._signalSharedFileDataOutOfDate(e.action.data);case M.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE:return this._signalSharedFolderDataOutOfDate(e.action.data);case M.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE:return this._signalSharedLinkDataOutOfDate(e.action.data);case M.SET_SHARED_FOLDER_DATA:return this._setNSSharedWithData(e.action.data);case M.SET_SHARED_LINK_DATA:return this._setSharedLinkData(e.action.data);case M.SET_SHARED_FILE_DATA:return this._setSharedFileData(e.action.data);case M.CLEAR_SHARED_FOLDER_DATA_FOR_NS:return this._clearSharedFolderDataForNs(e.action.data);case M.REMOVE_SHARED_LINK_DATA:return this._removeSharedLinkData(e.action.data)}},r.prototype._fillInMissingSharedLinkData=function(e){var t,r,s,n,o,i,a;for(a=e.parentPath,s=e.files,n=[],o=0,i=s.length;i>o;o++)r=s[o],this.hasLinkDataForFile(r)||(this._filesWeHaveSharedLinkDataFor[r.fq_path]=!0,n.push(r));return N.loadLinkDataForFiles({parentPath:a,fileFqPaths:function(){var e,r,s;for(s=[],e=0,r=n.length;r>e;e++)t=n[e],s.push(t.fq_path);return s}()})},r.prototype._canBeSharedFile=function(e){return!(e.is_dir||e.isDeleted())},r.prototype._loadSharedFileData=function(e){var t,r,s,n,o,i,a;if(n=(null!=e?e:{invalidateCache:!1}).invalidateCache,a=w.user(),g.Tiburon.filesFacesUI(a.id)){for(n&&(this._sharedFileDataByFileId={}),r=[],i=w.files().toArray(),s=0,o=i.length;o>s;s++)t=i[s],!this._canBeSharedFile(t)||t.file_id in this._sharedFileDataByFileId||r.push(t.file_id);return N.loadSharedFileDataForFiles({fileIds:r})}},r.prototype._pathLoaded=function(e){var t,r;return t=e.files,r=e.path,N.loadSFDataForPath({parentPath:r}),this._loadSharedFileData({invalidateCache:!0}),this._filesAdded({files:t,path:r})},r.prototype._filesAdded=function(e){var t,r;return t=e.files,r=e.path,this._fillInMissingSharedLinkData({parentPath:r,files:t}),this._loadSharedFileData()},r.prototype._filesChanged=function(e){var t,r,s;return s=e.path,r=e.fileDeltas,s===w.path()&&null!=r&&r.length?(u.waitFor([w.dispatchToken]),N.loadSFDataForPath({parentPath:s}),this.clearSharedLinkDataCache(),t=w.files().toArray(),this._fillInMissingSharedLinkData({parentPath:s,files:t}),this._loadSharedFileData({invalidateCache:!0})):void 0},r.prototype._signalSharedFileDataOutOfDate=function(e){var t;return t=e.fileIds,N.loadSharedFileDataForFiles({fileIds:t})},r.prototype._signalSharedFolderDataOutOfDate=function(e){var t;return t=e.parentPath,null==t&&(t=w.path()),N.loadSFDataForPath({parentPath:t})},r.prototype._signalSharedLinkDataOutOfDate=function(e){var t,r;return r=e.parentPath,t=e.fileFqPaths,null==r&&(r=w.path()),N.loadLinkDataForFiles({parentPath:r,fileFqPaths:t})},r.prototype._setNSSharedWithData=function(e){var t;return t=e.sharedFolderData,this._sharedFolderDataByTargetNs=t,this.emit_change()},r.prototype._setSharedLinkData=function(e){var t,r,s,n,o,i,a,l;for(n=e.parentPath,i=e.sharedLinkData,l=this._sharedLinkDataMapsByFolderFQPath[n]||{},r=0,s=i.length;s>r;r++)o=i[r],t=o.file,a=o.sharedLinkToken,l[this._sharedLinkKey(t)]=a;return this._sharedLinkDataMapsByFolderFQPath[n]=l,this.emit_change()},r.prototype._setSharedFileData=function(e){var t;return t=e.sharedFileData,n.extend(this._sharedFileDataByFileId,t),this.emit_change()},r.prototype._clearSharedFolderDataForNs=function(e){var t;return t=e.targetNs,this._sharedFolderDataByTargetNs[t]=void 0,this.emit_change()},r.prototype._browseInitializeEverything=function(e){var t,r;return r=e.path,t=e.files,N.loadSFDataForPath({parentPath:r}),this._filesAdded({path:r,files:t})},r.prototype._removeSharedLinkData=function(e){var t,r,s,n,o,i;for(o=e.parentPath,r=e.files,i=this._sharedLinkDataMapsByFolderFQPath[o]||{},s=0,n=r.length;n>s;s++)t=r[s],i[this._sharedLinkKey(t)]=void 0;return this._sharedLinkDataMapsByFolderFQPath[o]=i,this.emit_change()},r}(l),x=new O,t(document).on(k.REQUEST_SUCCEEDED_EVENT,function(e,t){var r;return r=t.request_url,u.dispatch(r.indexOf("/share_ajax/leave")>-1||r.indexOf("/share_ajax/unshare")>-1?{type:M.CLEAR_SHARED_FOLDER_DATA_FOR_NS,data:{targetNs:t.ns_id}}:{type:M.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE,data:{parentPath:w.path()}})}).on(y.LINKS_REMOVE,function(e,t){return u.dispatch({type:M.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{parentPath:w.path(),fileFqPaths:[t.fq_path]}})}).on(y.LINKS_ADD,function(e,t){return u.dispatch({type:M.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{parentPath:w.path(),fileFqPaths:[t.fq_path]}})}),N=function(){function e(){}return e.loadSFDataForPath=function(e){var t,r;return t=e.parentPath,r=w.user(),a.WebRequest({url:"/share_ajax/shared_with",dataType:"json",subject_user:r,data:{max_results:E,fq_path_prefix:t,include_inherited:!w.context().isInsideSharedFolder},success:function(e){var t,r,s,n,o;for(o={},t=0,r=e.length;r>t;t++)n=e[t],s={numUndisplayableUsersAndInvites:n.num_avatars_not_shown,groups:n.groups,invitations:n.invitations,joinedMembers:n.joined_members,includeInherited:!w.context().isInsideSharedFolder},o[n.ns_id]=s;return u.dispatch({type:M.SET_SHARED_FOLDER_DATA,data:{sharedFolderData:o}})}})},e.loadSharedFileDataForFiles=function(e){var t,r,s,n;return r=e.fileIds,n=w.user(),t=new D({userId:n.id}),(s=function(e){var r,n,o;return 0!==e.length?(o=e.slice(0,I),r=e.slice(I),n=t.listMembersBatch({contentIds:o,limit:E}),n.then(function(e){var t;return t={},e.forEach(function(e,r){return t[r]={numUndisplayableUsersAndInvites:0,groups:e.groups.valueSeq().map(g.apiGroupMemberToAvatarInfo).toArray(),invitations:e.invitees.valueSeq().map(g.apiInviteeMemberToAvatarInfo).toArray(),joinedMembers:e.users.valueSeq().map(g.apiUserMemberToAvatarInfo).toArray()}}),u.dispatch({type:M.SET_SHARED_FILE_DATA,data:{sharedFileData:t}}),r?s(r):void 0})):void 0})(r)},e.loadLinkDataForFiles=function(e){var t,s,n,o;return s=e.parentPath,t=e.fileFqPaths,o=w.user(),(n=function(e){var t,i;return 0!==e.length?(i=e.slice(0,R),t=e.slice(R),a.SilentBackgroundRequest({url:"/sm/get_token_info",dataType:"json",data:{paths:JSON.stringify(i)},subject_user:o,success:function(e){var o,a,l,c,p,d,h,f,m,_,g;for(l=w.filesMap(),m=[],h=e.shmodels,c=0,p=h.length;p>c;c++)g=h[c],g.disabled||(o=l.get(g.path),o&&m.push({file:o,sharedLinkToken:g}));return m.length&&u.dispatch({type:M.SET_SHARED_LINK_DATA,data:{parentPath:s,sharedLinkData:m}}),_=function(){var t,r,s,n;for(s=e.shmodels,n=[],t=0,r=s.length;r>t;t++)f=s[t],n.push(f.path);return n}(),a=function(){var e,t,s;for(s=[],e=0,t=i.length;t>e;e++)d=i[e],r.call(_,d)>=0||s.push(l.get(d));return s}().filter(function(e){return null!=e}),a.length&&u.dispatch({type:M.REMOVE_SHARED_LINK_DATA,data:{parentPath:s,files:a}}),t?n(t):void 0}})):void 0})(t)},e}(),A=s.createClass({displayName:"SharedWithController",mixins:[c(x)],propTypes:{browseContext:s.PropTypes.instanceOf(v).isRequired,file:s.PropTypes.instanceOf(T).isRequired},_get_state_from_stores:function(e){var t,r,s,n,o;return t=x.getDataForFile(e.file),t?{numUndisplayableUsersAndInvites:null!=(r=t.numUndisplayableUsersAndInvites)?r:0,groups:null!=(s=t.groups)?s:[],invitations:null!=(n=t.invitations)?n:[],joinedMembers:null!=(o=t.joinedMembers)?o:[],sharedLinkInfo:t.sharedLinkInfo}:{numUndisplayableUsersAndInvites:0,groups:[],invitations:[],joinedMembers:[],sharedLinkInfo:null}},componentWillReceiveProps:function(e){return this.setState(this._get_state_from_stores(e))},_showSharingModal:function(){var e,t,r;return t=[w.user(),this.props.file],r=t[0],e=t[1],U(r,e,{browseContext:this.props.browseContext})?void 0:require(["dropbox"],function(t){var s;return s=t.ExistingSharedFolderOptionsModal,e.is_dir?new s(r,e.fq_path).show():void 0})},handleOverflowCountClick:function(){return this._showSharingModal()},handleAvatarClick:function(){return this._showSharingModal()},handleSharedLinkClick:function(){var e;return e=w.user(),F.get_for_user(e).verified_or_show()&&!U(e,this.props.file,{browseContext:this.props.browseContext})?require(["dropbox"],function(t){return function(r){var s,n;return n=r.SharingShmodel,s=r.Browse,null==s.active_user&&(s.active_user=e),n.shmodel(t.props.file.fq_path,C)}}(this)):void 0},render:function(){return q(L,{user:w.user(),file:this.props.file,numUndisplayableUsersAndInvites:this.state.numUndisplayableUsersAndInvites,groups:this.state.groups,invitations:this.state.invitations,joinedMembers:this.state.joinedMembers,sharedLinkInfo:this.state.sharedLinkInfo,animation:!1,onOverflowCountClick:this.handleOverflowCountClick,onAvatarClick:this.handleAvatarClick,onSharedLinkClick:this.handleSharedLinkClick,maxVisibleAvatars:E})}}),{SharedWithController:A,SharedWithStore:x}})}.call(this),function(){define("modules/dirty/search/search_results",["external/immutable","external/react","external/underscore","modules/clean/flux/store_mixin","modules/clean/react/css","modules/clean/search/actions","modules/clean/search/store","modules/dirty/search/search_results_view"],function(e,t,r,s,n,o,i,a){var l,u,c;return c=t.DOM,u=t.createElement,l=t.createClass({displayName:"SearchResultsController",mixins:[s(i)],_get_state_from_stores:function(){return{hasMoreResults:i.hasMoreResults(),loadingState:i.loadingState(),latestQuery:i.latestQuery(),numDeletedResults:i.numDeletedResults(),searchResults:i.searchResults(),selection:i.selection()}},propTypes:{onPathOpen:t.PropTypes.func,path:t.PropTypes.string,searchBarElement:t.PropTypes.element.isRequired,user:t.PropTypes.object},_handleScroll:function(){var e;return e=this.getDOMNode().getBoundingClientRect(),e.bottom<=window.innerHeight?o.loadMoreResults({path:this.props.path,user:this.props.user}):void 0},render:function(){return u(a,r.extend({},{onScroll:r.throttle(this._handleScroll,200),onSelectionChange:o.setSearchSelection,path:this.props.path,searchBarElement:this.props.searchBarElement,user:this.props.user},this.state))}}),l=n(l,["/static/css/browse/browse-vflyaF8OY.css"])})}.call(this),function(){define("modules/dirty/search/search_results_view",["jquery","external/immutable","external/react","external/underscore","modules/clean/react/browse/constants","modules/clean/react/image","modules/clean/react/react_i18n","modules/clean/search/constants","modules/clean/search/search_helpers","modules/clean/static_urls","modules/core/i18n","modules/core/uri","modules/dirty/react/browse/actions","modules/dirty/react/browse/file_list","modules/dirty/react/browse/share_button","modules/clean/react/browse/store"],function(e,t,r,s,n,o,i,a,l,u,c,p,d,h,f,m){var _,g,y,S,b,v,w,F,T,D,P,R,C;return g=n.DropTargetHighlightMode,S=n.LoadingStates,b=n.NewFolderCreationState,v=i.R_,w=a.SearchLoadingStates,C=u.static_url,D=c._,y=h.FileListController,T=f.ShareButton,_=m.BrowseContext,R=r.DOM,P=r.createElement,F=r.createClass({displayName:"SearchResultsView",propTypes:{hasMoreResults:r.PropTypes.bool,loadingState:r.PropTypes.oneOf(s.values(w)),latestQuery:r.PropTypes.string,onScroll:r.PropTypes.func,path:r.PropTypes.string,searchBarElement:r.PropTypes.element,searchResults:r.PropTypes.instanceOf(t.List),selection:r.PropTypes.object,user:r.PropTypes.object},componentDidMount:function(){return e(window).on("scroll.SearchResults",this.props.onScroll)},componentWillUnmount:function(){return e(window).off("scroll.SearchResults")},renderEmptyFolderView:function(){return R.div({className:"u-font-center u-pad-top-xl"},P(o,{src:C("/static/images/empty_states/search-vfl6DaX2I.png"),srcHiRes:C("/static/images/empty_states/search@2x-vflBsUhDE.png"),alt:""}),R.h2({},D("No results found")),R.div({},D("Please update your search and try again")))},render:function(){var e;return e=this.props.loadingState===w.LOADING_FIRST_PAGE?S.LOADING_FIRST_PAGE:this.props.loadingState===w.LOADING_ADDITIONAL_PAGE?S.LOADING_REMAINING_PAGES:S.LOADED,R.div({className:"search-results",id:"browse-box"},R.div({className:"search-results__header",id:"browse-header"},R.h1({className:"search-results__title"},D(this.props.loadingState!==w.LOADED?"Searching…":"Results for ‘%(query)s’".format({query:this.props.latestQuery}))),this.props.searchBarElement,this.props.loadingState!==w.LOADING_FIRST_PAGE&&this.props.searchResults.size?R.div({className:"search-results__info"},this.props.hasMoreResults?D("Over %(num_results)d results in files, folders, and content.").format({num_results:this.props.searchResults.size}):D("%(num_results)d results in files, folders, and content.").format({num_results:this.props.searchResults.size})):void 0),P(y,{context:new _,files:this.props.searchResults,loadingState:e,isColumnHeaderVisible:!1,isMultiColumnGroupVisible:!1,isPaginating:!1,isShortcutsMenuVisible:!1,isTextSelectable:!1,isDragAndDropEnabled:!1,shouldShowDeletedFiles:!1,showContainingPaths:!0,showFilenameHighlights:!0,user:this.props.user,selection:this.props.selection,onSelectionChange:this.props.onSelectionChange,customEmptyFolderView:this.renderEmptyFolderView}))}})})}.call(this);